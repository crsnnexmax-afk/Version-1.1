<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ðŸ”¥ FIREBASE REAL-TIME DASHBOARD                              â•‘
â•‘                  Bank Management System - Multi-User                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“‹ SETUP INSTRUCTIONS (10 MINUTES):

1ï¸âƒ£  CREATE FIREBASE PROJECT:
    â†’ Go to: https://console.firebase.google.com
    â†’ Click "Add Project"  
    â†’ Name: "Bank-Management-Dashboard"
    â†’ Disable Google Analytics
    â†’ Click "Create Project"

2ï¸âƒ£  CREATE REALTIME DATABASE:
    â†’ Click "Realtime Database" in left menu
    â†’ Click "Create Database"
    â†’ Location: Singapore (asia-southeast1)
    â†’ Start in TEST MODE
    â†’ Click "Enable"

3ï¸âƒ£  GET FIREBASE CONFIG:
    â†’ Click âš™ï¸ (Settings) â†’ Project Settings
    â†’ Scroll to "Your apps"
    â†’ Click </> (Web) icon
    â†’ App nickname: "Bank Dashboard"
    â†’ Click "Register app"
    â†’ COPY the firebaseConfig object

4ï¸âƒ£  PASTE CONFIG TO THIS FILE:
    â†’ Find line ~1270 (search for: YOUR-API-KEY-HERE)
    â†’ REPLACE the dummy config with YOUR config
    â†’ Save file

5ï¸âƒ£  DEPLOY TO NETLIFY:
    â†’ Go to: https://app.netlify.com/drop
    â†’ Drag & drop THIS file
    â†’ Get URL: https://xxx-yyy.netlify.app
    â†’ Share with staff!

6ï¸âƒ£  FIRST TIME SETUP (ONE-TIME):
    â†’ Open dashboard in browser
    â†’ Login as BM Officer
    â†’ You'll see orange button bottom-right: "Upload Initial Data"
    â†’ Click it ONCE
    â†’ Wait 10 seconds
    â†’ âœ… Data uploaded to Firebase!
    â†’ Button disappears
    â†’ Refresh page

7ï¸âƒ£  TEST REAL-TIME SYNC:
    â†’ Open dashboard in Chrome
    â†’ Login as BM Officer, add new account
    â†’ Open SAME URL in Firefox (or incognito)
    â†’ Login as PE Officer
    â†’ âœ… You should see the account you just added!
    â†’ Changes in Chrome appear in Firefox within 1-2 seconds!

ðŸŽ‰ DONE! Your dashboard is now real-time!

âš ï¸  IMPORTANT NOTES:
    â€¢ First user to login should click "Upload Initial Data" button (appears bottom-right)
    â€¢ After upload, button disappears automatically
    â€¢ All subsequent users will see synced data
    â€¢ Data syncs in real-time (1-2 second delay)
    â€¢ All current features preserved (Export CV, Remark, etc.)
    â€¢ Works for 3-5 staff (FREE Firebase tier)

ðŸ”’ SECURITY (Do Later):
    After testing, go to Firebase Console â†’ Database â†’ Rules:
    {
      "rules": {
        "databases": {
          ".read": true,
          ".write": true
        }
      }
    }

ðŸ“ž SUPPORT:
    If stuck, check browser console (F12) for errors
    Make sure Firebase config is correct
    Make sure "Upload Initial Data" was clicked

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Management Dashboard - Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- ðŸ”¥ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    
    <script>
        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘                    ðŸ”¥ FIREBASE CONFIGURATION                         â•‘
        // â•‘                                                                      â•‘
        // â•‘  âš ï¸âš ï¸âš ï¸ STEP: PASTE YOUR FIREBASE CONFIG HERE âš ï¸âš ï¸âš ï¸                  â•‘
        // â•‘                                                                      â•‘
        // â•‘  1. DELETE lines 21-28 below (the dummy config)                     â•‘
        // â•‘  2. PASTE your Firebase config from Firebase Console                â•‘
        // â•‘  3. Make sure it starts with: const firebaseConfig = {              â•‘
        // â•‘  4. SAVE this file (Ctrl+S)                                         â•‘
        // â•‘                                                                      â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // â¬‡ï¸â¬‡ï¸â¬‡ï¸ DELETE FROM HERE â¬‡ï¸â¬‡ï¸â¬‡ï¸
        const firebaseConfig = {
            apiKey: "YOUR-API-KEY-HERE",
            authDomain: "YOUR-PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR-PROJECT-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "YOUR-PROJECT-ID",
            storageBucket: "YOUR-PROJECT.appspot.com",
            messagingSenderId: "YOUR-SENDER-ID",
            appId: "YOUR-APP-ID"
        };
        // â¬†ï¸â¬†ï¸â¬†ï¸ DELETE TO HERE â¬†ï¸â¬†ï¸â¬†ï¸
        
        // After pasting your config, the section should look like:
        // const firebaseConfig = {
        //   apiKey: "AIzaSyXXXXX...",      â† Your real values
        //   authDomain: "your-app.firebaseapp.com",
        //   etc...
        // };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        console.log("ðŸ”¥ Firebase initialized!");
        
        // ==================== SESSION PERSISTENCE ====================
        function saveSession(user) {
            sessionStorage.setItem('userSession', JSON.stringify({
                username: user.username,
                role: user.role,
                timestamp: Date.now()
            }));
        }
        
        function loadSession() {
            const session = sessionStorage.getItem('userSession');
            if (!session) return null;
            
            const data = JSON.parse(session);
            // Session valid for 24 hours
            if (Date.now() - data.timestamp > 24 * 60 * 60 * 1000) {
                sessionStorage.removeItem('userSession');
                return null;
            }
            
            return data;
        }
        
        function clearSession() {
            sessionStorage.removeItem('userSession');
        }
        // ==================== END SESSION ====================

    </script>


    
    <style>
        * { box-sizing: border-box; }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .hidden { display: none; }
        
        /* PE Officer - Hide sensitive columns in Acc Details */
        .pe-officer-mode .acc-details-col-bankpw,
        .pe-officer-mode .acc-details-col-email,
        .pe-officer-mode .acc-details-col-passemail,
        .pe-officer-mode .acc-details-col-actions {
            display: none !important;
        }
        
        /* Wealth+ - Hide sensitive columns in Stock Email and Acc Details */
        .wealth-mode .stock-email-col-password,
        .wealth-mode .stock-email-col-device,
        .wealth-mode .stock-email-col-actions,
        .wealth-mode .acc-details-col-bankpw,
        .wealth-mode .acc-details-col-email,
        .wealth-mode .acc-details-col-passemail,
        .wealth-mode .acc-details-col-actions,
        .wealth-mode .bank-issues-col-actions {
            display: none !important;
        }
        
        /* Wealth+ - Show Edit button for Status column */
        .wealth-mode .stock-email-status-edit {
            display: inline-block !important;
        }
        
        /* Label with Add Button - Flex layout to separate clickable areas */
        .label-with-button {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .label-with-button .form-label {
            margin: 0;
            pointer-events: none; /* Prevent label from capturing clicks */
        }
        
        .label-with-button .add-option-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .label-with-button .add-option-btn:hover {
            background: #059669;
        }
        
        .database-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .database-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Data Table Styles */
        .data-table-container {
            overflow-x: auto;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .data-table thead {
            background: #1e40af;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table th {
            color: white;
            font-weight: 600;
            padding: 12px 8px;
            text-align: left;
            border: 1px solid #1e3a8a;
            white-space: nowrap;
        }
        
        .data-table td {
            padding: 8px;
            border: 1px solid #e5e7eb;
            background: white;
            vertical-align: middle;
        }
        
        .data-table tbody tr:hover {
            background: #eff6ff;
        }
        
        .data-table input, .data-table select, .data-table textarea {
            width: 100%;
            border: 1px solid #d1d5db;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .data-table input:focus, .data-table select:focus, .data-table textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .data-table input[type="date"] {
            min-width: 130px;
        }
        
        .data-table td {
            white-space: normal;
            word-wrap: break-word;
            max-width: 250px;
        }
        
        .data-table td select {
            white-space: nowrap;
        }
        
        /* Stats Card */
        .stat-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card-title {
            font-size: 14px;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .stat-card-value {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
        }
        
        /* Section Headers */
        .section-header {
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
        }
        
        /* Button Styles */
        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        /* Tab Styles */
        .tab-button {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e5e7eb;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 4px;
        }
        
        .tab-button:hover {
            background: #f9fafb;
            color: #1f2937;
        }
        
        .tab-button.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }
        
        /* Month Filter */
        .month-filter {
            display: inline-block;
            padding: 8px 12px;
            border: 2px solid #3b82f6;
            border-radius: 6px;
            background: white;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Scrollbar */
        .data-table-container::-webkit-scrollbar {
            height: 8px;
        }
        
        .data-table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .data-table-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        .data-table-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Text Truncation with Tooltip */
        .truncate-text {
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: help;
            position: relative;
        }
        
        .truncate-text:hover::after {
            content: attr(data-full-text);
            position: absolute;
            left: 0;
            top: 100%;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: normal;
            width: max-content;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 12px;
            margin-top: 4px;
        }
        
        /* Modal Popup */
        .popup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        
        .popup-modal.active {
            display: flex;
        }
        
        .popup-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 1400px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .popup-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
        
        .popup-close {
            background: #ef4444;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .popup-close:hover {
            background: #dc2626;
            transform: rotate(90deg);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        .form-input {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 2px solid #e5e7eb;
        }
        
        .btn-cancel {
            background: #6b7280;
            color: white;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-cancel:hover {
            background: #4b5563;
        }
        
        .btn-save {
            background: #10b981;
            color: white;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-save:hover {
            background: #059669;
        }
        
        /* Success Notification */
        .success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 10000;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .success-notification.active {
            display: block;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-96 fade-in">
            <div class="text-center mb-8">
                <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-university text-blue-600 text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800">Bank Management</h1>
                <p class="text-gray-500 mt-2">By Danial</p>
            </div>
            
            <form id="loginForm">
                <div id="errorMessage" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"></div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">
                        <i class="fas fa-user mr-2"></i>Username
                    </label>
                    <input type="text" id="username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">
                        <i class="fas fa-lock mr-2"></i>Password
                    </label>
                    <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                </div>
                
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition duration-200">
                    Login
                </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-gray-500">
                <p>Version 1.0</p>
            </div>
        </div>
    </div>

    <!-- Database Selection Page -->
    <div id="databaseSelectionPage" class="hidden min-h-screen bg-gray-100">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="bg-blue-600 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-university text-white"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">Bank Management</h1>
                </div>
                <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Select Database</h2>
                <p class="text-gray-600 text-lg">Choose a currency database to manage</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div onclick="selectDatabase('SGD')" class="database-card bg-gradient-to-br from-red-500 to-red-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-dollar-sign text-5xl"></i>
                        </div>
                        <h3 class="text-3xl font-bold mb-2">SGD Database</h3>
                        <p class="text-red-100 mb-6">Singapore Dollar</p>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <p class="text-sm mb-1">Total Records</p>
                            <p class="text-2xl font-bold" id="sgdCount">0</p>
                        </div>
                    </div>
                </div>

                <div onclick="selectDatabase('MYR')" class="database-card bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-coins text-5xl"></i>
                        </div>
                        <h3 class="text-3xl font-bold mb-2">MYR Database</h3>
                        <p class="text-yellow-100 mb-6">Malaysian Ringgit</p>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <p class="text-sm mb-1">Total Records</p>
                            <p class="text-2xl font-bold" id="myrCount">0</p>
                        </div>
                    </div>
                </div>

                <div onclick="selectDatabase('KHR')" class="database-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-money-bill-wave text-5xl"></i>
                        </div>
                        <h3 class="text-3xl font-bold mb-2">KHR Database</h3>
                        <p class="text-blue-100 mb-6">Cambodian Riel</p>
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <p class="text-sm mb-1">Total Records</p>
                            <p class="text-2xl font-bold" id="khrCount">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Role Selection Page -->
    <div id="roleSelectionPage" class="hidden min-h-screen bg-gray-100">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <button onclick="backToDatabaseSelection()" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div class="bg-blue-600 w-10 h-10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-university text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Bank Management</h1>
                        <p id="selectedDatabaseText" class="text-sm text-gray-600"></p>
                    </div>
                </div>
                <button id="logoutBtnRole" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </header>

        <div class="max-w-6xl mx-auto px-4 py-12">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Select Your Role</h2>
                <p class="text-gray-600 text-lg">Choose your position to continue</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div onclick="selectRole('BM Officer')" class="database-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-user-tie text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">BM Officer</h3>
                        <p class="text-blue-100 text-sm">Bank Management Officer</p>
                    </div>
                </div>

                <div onclick="selectRole('PE Officer')" class="database-card bg-gradient-to-br from-green-500 to-green-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-briefcase text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">PE Officer</h3>
                        <p class="text-green-100 text-sm">Payment Executive Officer</p>
                    </div>
                </div>

                <div onclick="selectRole('Wealth+')" class="database-card bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-gem text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">Wealth+</h3>
                        <p class="text-purple-100 text-sm">Wealth+ Management</p>
                    </div>
                </div>

                <div onclick="selectRole('Others')" class="database-card bg-gradient-to-br from-gray-500 to-gray-600 rounded-2xl shadow-xl p-8 text-white">
                    <div class="text-center">
                        <div class="bg-white bg-opacity-20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-users text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-2">Others</h3>
                        <p class="text-gray-100 text-sm">Other Positions</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-50">
            <div class="max-w-full mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <button onclick="backToSelection()" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <div class="bg-blue-600 w-10 h-10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-university text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Bank Management Dashboard</h1>
                        <p id="databaseRoleTitle" class="text-sm text-gray-600"></p>
                    </div>
                </div>
                <button id="logoutBtn2" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </header>

        <!-- Welcome Banner -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-6">
            <div class="max-w-full mx-auto px-4 flex justify-between items-center">
                <div>
                    <h2 id="welcomeMessage" class="text-2xl font-bold mb-1"></h2>
                    <p class="text-blue-100">Manage your customer data and transactions</p>
                </div>
                <button id="exportCVBtn" onclick="exportToCV()" style="background: white; color: #4f46e5; padding: 10px 20px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(0,0,0,0.1)'">
                    <i class="fas fa-file-pdf" style="margin-right: 8px;"></i>Export CV
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-full mx-auto px-4 py-6">
            
            <!-- Stats Cards Row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                <div class="stat-card">
                    <div class="stat-card-title">Total Bank Active</div>
                    <div class="stat-card-value" id="totalBankActive">0</div>
                    <div class="text-xs text-gray-500 mt-2">
                        <i class="fas fa-filter mr-1"></i>
                        <select id="filterBankActive" class="month-filter text-xs" onchange="filterByMonth('bankActive')">
                            <option value="">All Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">Total Bank Issues</div>
                    <div class="stat-card-value text-red-600" id="totalBankIssues">0</div>
                    <div class="text-xs text-gray-500 mt-2">
                        <i class="fas fa-filter mr-1"></i>
                        <select id="filterBankIssues" class="month-filter text-xs" onchange="filterByMonth('bankIssues')">
                            <option value="">All Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">Total Payment Rent</div>
                    <div class="stat-card-value text-blue-600" id="totalPaymentRent">$0</div>
                    <div class="text-xs text-gray-500 mt-2">
                        <i class="fas fa-filter mr-1"></i>
                        <select id="filterPaymentRent" class="month-filter text-xs" onchange="filterByMonth('paymentRent')">
                            <option value="">All Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">Total Recover Balance</div>
                    <div class="stat-card-value text-green-600" id="totalRecoverBalance">$0</div>
                    <div class="text-xs text-gray-500 mt-2">
                        <i class="fas fa-filter mr-1"></i>
                        <select id="filterRecoverBalance" class="month-filter text-xs" onchange="filterByMonth('recoverBalance')">
                            <option value="">All Month</option>
                        </select>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card-title">Total Lost Balance</div>
                    <div class="stat-card-value text-red-600" id="totalLostBalance">$0</div>
                    <div class="text-xs text-gray-500 mt-2">
                        <i class="fas fa-filter mr-1"></i>
                        <select id="filterLostBalance" class="month-filter text-xs" onchange="filterByMonth('lostBalance')">
                            <option value="">All Month</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="flex gap-2 mb-4 flex-wrap">
                <button class="tab-button active" onclick="switchTab('stockEmail')" id="tabStockEmail">
                    <i class="fas fa-envelope mr-2"></i>Stock Email
                </button>
                <button class="tab-button" onclick="switchTab('accDetails')" id="tabAccDetails">
                    <i class="fas fa-file-alt mr-2"></i>Acc Details
                </button>
                <button class="tab-button" onclick="switchTab('accStatusCheck')" id="tabAccStatusCheck">
                    <i class="fas fa-check-circle mr-2"></i>Acc Status Check
                </button>
                <button class="tab-button" onclick="switchTab('bankFollowUp')" id="tabBankFollowUp">
                    <i class="fas fa-tasks mr-2"></i>Bank Issues
                </button>
                <button class="tab-button" onclick="switchTab('lastInOut')" id="tabLastInOut">
                    <i class="fas fa-exchange-alt mr-2"></i>Last In Out
                </button>
                <button class="tab-button" onclick="switchTab('operatorReport')" id="tabOperatorReport">
                    <i class="fas fa-chart-bar mr-2"></i>Operator Report
                </button>
                <button class="tab-button" onclick="switchTab('template')" id="tabTemplate">
                    <i class="fas fa-file-alt mr-2"></i>Template
                </button>
            </div>

            <!-- Tab Contents -->
            
            <!-- Stock Email Tab -->
            <div id="contentStockEmail" class="fade-in">
                <div class="mb-4 flex justify-between items-center">
                    <h3 class="section-title text-2xl">Stock Email</h3>
                    <button id="btnAddStockEmail" class="btn-success text-lg px-6 py-3" onclick="openAddPopup('stockEmail')">
                        <i class="fas fa-plus mr-2"></i>Add Data
                    </button>
                </div>
                
                <!-- Filter Section -->
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 16px; display: flex; gap: 16px; align-items: center;">
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <i class="fas fa-filter" style="color: #6b7280;"></i>
                        <label style="font-weight: 500; color: #374151;">Filter Assign:</label>
                        <select id="filterStockEmailAssign" onchange="filterStockEmailTable()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                            <option value="all">All Assign</option>
                            <option value="SGD">SGD</option>
                            <option value="MYR">MYR</option>
                            <option value="KHR">KHR</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <i class="fas fa-filter" style="color: #6b7280;"></i>
                        <label style="font-weight: 500; color: #374151;">Filter Status:</label>
                        <select id="filterStockEmailStatus" onchange="filterStockEmailTable()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                            <option value="all">All Status</option>
                            <option value="Used">Used</option>
                            <option value="New">New</option>
                            <option value="Suspend">Suspend</option>
                        </select>
                    </div>
                </div>
                
                <div class="data-table-container" style="max-height: 500px; overflow-y: auto;">
                    <table class="data-table" id="tableStockEmail">
                        <thead>
                            <tr>
                                <th style="width: 120px;">Date</th>
                                <th style="width: 200px;">Email</th>
                                <th class="stock-email-col-password" style="width: 150px;">Password</th>
                                <th style="width: 150px;">Number Phone</th>
                                <th class="stock-email-col-device" style="width: 120px;">Device</th>
                                <th style="width: 150px;">Assign</th>
                                <th style="width: 120px;">Status</th>
                                <th class="stock-email-col-actions" style="width: 100px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyStockEmail">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Acc Details Tab -->
            <div id="contentAccDetails" class="hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h3 class="section-title text-2xl">Account Details</h3>
                    <button id="btnAddAccDetails" class="btn-success text-lg px-6 py-3" onclick="openAddPopup('accDetails')">
                        <i class="fas fa-plus mr-2"></i>Add Data
                    </button>
                </div>
                
                <!-- Filter Section -->
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 16px; display: flex; gap: 16px; align-items: center;">
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <i class="fas fa-filter" style="color: #6b7280;"></i>
                        <label style="font-weight: 500; color: #374151;">Filter Bank Name:</label>
                        <select id="filterAccDetailsBank" onchange="filterAccDetailsTable()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                            <option value="all">All Banks</option>
                            <option value="Liquidpay">Liquidpay</option>
                            <option value="Mari Bank">Mari Bank</option>
                            <option value="DBS/POSB">DBS/POSB</option>
                            <option value="GXS Bank">GXS Bank</option>
                            <option value="Trust Bank">Trust Bank</option>
                            <option value="May Bank">May Bank</option>
                            <option value="CIMB">CIMB</option>
                            <option value="CORP Mari">CORP Mari</option>
                            <option value="CORP DBS/POSB">CORP DBS/POSB</option>
                            <option value="CORP GXS">CORP GXS</option>
                            <option value="CORP CIMB">CORP CIMB</option>
                        </select>
                    </div>
                </div>
                
                <div class="data-table-container" style="max-height: 600px; overflow: auto;">
                    <table class="data-table" id="tableAccDetails" style="min-width: 2600px;">
                        <thead>
                            <tr>
                                <th style="min-width: 150px;">Bank Name</th>
                                <th style="min-width: 200px;">Holder Name</th>
                                <th style="min-width: 180px;">Acc Number</th>
                                <th style="min-width: 120px;">Source</th>
                                <th style="min-width: 100px;">Device</th>
                                <th style="min-width: 120px;">Assign</th>
                                <th style="min-width: 120px;">Status</th>
                                <th style="min-width: 200px;">Remark</th>
                                <th style="min-width: 140px;">Start Date</th>
                                <th style="min-width: 140px;">End Date</th>
                                <th style="min-width: 140px;">Username</th>
                                <th class="acc-details-col-bankpw" style="min-width: 140px;">Bank PW/PIN</th>
                                <th class="acc-details-col-email" style="min-width: 220px;">Email</th>
                                <th class="acc-details-col-passemail" style="min-width: 140px;">Pass Email</th>
                                <th style="min-width: 120px;">VPN</th>
                                <th style="min-width: 180px;">Agent Name</th>
                                <th class="acc-details-col-actions" style="min-width: 120px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyAccDetails">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Acc Status Check Tab -->
            <div id="contentAccStatusCheck" class="hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h3 class="section-title text-2xl">Account Status Check</h3>
                    <button class="btn-success text-lg px-6 py-3" onclick="openAddPopup('accStatusCheck')">
                        <i class="fas fa-plus mr-2"></i>Add Data
                    </button>
                </div>
                
                <!-- Filter Section -->
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 16px; display: flex; gap: 16px; align-items: center;">
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <i class="fas fa-filter" style="color: #6b7280;"></i>
                        <label style="font-weight: 500; color: #374151;">Filter Status:</label>
                        <select id="filterAccStatusStatus" onchange="filterAccStatusTable()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                            <option value="all">All Status</option>
                            <option value="Balance cleared" style="color: #9333ea; font-weight: 600;">ðŸŸ£ Balance cleared</option>
                            <option value="Balance refunded" style="color: #9333ea; font-weight: 600;">ðŸŸ£ Balance refunded</option>
                            <option value="Balance In Progress" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ Balance In Progress</option>
                            <option value="Bank Owner Used" style="color: #ef4444; font-weight: 600;">ðŸ”´ Bank Owner Used</option>
                        </select>
                    </div>
                </div>
                
                <div class="data-table-container" style="max-height: 500px; overflow-y: auto;">
                    <table class="data-table" id="tableAccStatusCheck">
                        <thead>
                            <tr>
                                <th style="width: 150px;">Holder Name</th>
                                <th style="width: 120px;">Group</th>
                                <th style="width: 120px;">Payment Rent</th>
                                <th style="width: 150px;">Agent</th>
                                <th style="width: 120px;">Total Receive</th>
                                <th style="width: 120px;">Balance</th>
                                <th style="width: 120px;">Lost</th>
                                <th style="width: 150px;">Status</th>
                                <th style="width: 200px;">Remark</th>
                                <th style="width: 100px;">Month</th>
                                <th style="width: 100px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyAccStatusCheck">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Bank Issues Tab -->
            <div id="contentBankFollowUp" class="hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h3 class="section-title text-2xl">Bank Issues</h3>
                    <button id="btnAddBankIssues" class="btn-success text-lg px-6 py-3" onclick="openAddPopup('bankFollowUp')">
                        <i class="fas fa-plus mr-2"></i>Add Data
                    </button>
                </div>
                
                <!-- Filter Section -->
                <div style="background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 16px; display: flex; gap: 16px; align-items: center;">
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <i class="fas fa-filter" style="color: #6b7280;"></i>
                        <label style="font-weight: 500; color: #374151;">Filter Bank Name:</label>
                        <select id="filterBankIssuesBank" onchange="filterBankIssuesTable()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                            <option value="all">All Banks</option>
                            <option value="Liquidpay">Liquidpay</option>
                            <option value="Mari Bank">Mari Bank</option>
                            <option value="DBS/POSB">DBS/POSB</option>
                            <option value="GXS Bank">GXS Bank</option>
                            <option value="Trust Bank">Trust Bank</option>
                            <option value="May Bank">May Bank</option>
                            <option value="CIMB">CIMB</option>
                            <option value="CORP Mari">CORP Mari</option>
                            <option value="CORP DBS/POSB">CORP DBS/POSB</option>
                            <option value="CORP GXS">CORP GXS</option>
                            <option value="CORP CIMB">CORP CIMB</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <label style="font-weight: 500; color: #374151;">Filter Status:</label>
                        <select id="filterBankIssuesStatus" onchange="filterBankIssuesTable()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                            <option value="all">All Status</option>
                            <option value="Pending" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ Pending</option>
                            <option value="In Progress" style="color: #3b82f6; font-weight: 600;">ðŸ”µ In Progress</option>
                            <option value="Resolved" style="color: #10b981; font-weight: 600;">ðŸŸ¢ Resolved</option>
                            <option value="Closed" style="color: #6b7280; font-weight: 600;">âš« Closed</option>
                        </select>
                    </div>
                </div>
                
                <div class="data-table-container" style="max-height: 500px; overflow-y: auto;">
                    <table class="data-table" id="tableBankFollowUp" style="min-width: 2000px;">
                        <thead>
                            <tr>
                                <th style="min-width: 130px;">Date Issues</th>
                                <th style="min-width: 150px;">Bank Name</th>
                                <th style="min-width: 150px;">Holder Name</th>
                                <th style="min-width: 150px;">Acc Number</th>
                                <th style="min-width: 100px;">Device</th>
                                <th style="min-width: 200px;">Issues Description</th>
                                <th style="min-width: 180px;">Status</th>
                                <th style="min-width: 150px;">Handler</th>
                                <th style="min-width: 150px;">Total Lost Balance</th>
                                <th style="min-width: 150px;">Total Recover Balance</th>
                                <th style="min-width: 200px;">Remark</th>
                                <th class="bank-issues-col-actions" style="min-width: 100px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyBankFollowUp">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Last In Out Tab -->
            <div id="contentLastInOut" class="hidden">
                <div class="mb-4">
                    <h3 class="section-title text-2xl">Last In Out Transactions</h3>
                </div>
                
                <div class="data-table-container" style="max-height: 600px; overflow: auto;">
                    <table class="data-table" id="tableLastInOut" style="min-width: 2800px;">
                        <thead>
                            <tr>
                                <th style="width: 130px;">Date Issues</th>
                                <th style="width: 120px;">Bank Name</th>
                                <th style="width: 150px;">Holder Name</th>
                                <th style="width: 150px;">Acc Number</th>
                                <th style="width: 120px;">Last Balance</th>
                                <th style="width: 150px;">Issues</th>
                                <!-- Last In 1 -->
                                <th style="width: 130px; background: #10b981; color: white; border-left: 3px solid #059669;">Last In (1) Date</th>
                                <th style="width: 150px; background: #10b981; color: white;">Last In (1) Name</th>
                                <th style="width: 120px; background: #10b981; color: white; border-right: 3px solid #059669;">Last In (1) Amount</th>
                                <!-- Last In 2 -->
                                <th style="width: 130px; background: #10b981; color: white; border-left: 3px solid #059669;">Last In (2) Date</th>
                                <th style="width: 150px; background: #10b981; color: white;">Last In (2) Name</th>
                                <th style="width: 120px; background: #10b981; color: white; border-right: 3px solid #059669;">Last In (2) Amount</th>
                                <!-- Last In 3 -->
                                <th style="width: 130px; background: #10b981; color: white; border-left: 3px solid #059669;">Last In (3) Date</th>
                                <th style="width: 150px; background: #10b981; color: white;">Last In (3) Name</th>
                                <th style="width: 120px; background: #10b981; color: white; border-right: 3px solid #059669;">Last In (3) Amount</th>
                                <!-- Last Out 1 -->
                                <th style="width: 130px; background: #ef4444; color: white; border-left: 3px solid #dc2626;">Last Out (1) Date</th>
                                <th style="width: 150px; background: #ef4444; color: white;">Last Out (1) Name</th>
                                <th style="width: 120px; background: #ef4444; color: white; border-right: 3px solid #dc2626;">Last Out (1) Amount</th>
                                <!-- Last Out 2 -->
                                <th style="width: 130px; background: #ef4444; color: white; border-left: 3px solid #dc2626;">Last Out (2) Date</th>
                                <th style="width: 150px; background: #ef4444; color: white;">Last Out (2) Name</th>
                                <th style="width: 120px; background: #ef4444; color: white; border-right: 3px solid #dc2626;">Last Out (2) Amount</th>
                                <!-- Last Out 3 -->
                                <th style="width: 130px; background: #ef4444; color: white; border-left: 3px solid #dc2626;">Last Out (3) Date</th>
                                <th style="width: 150px; background: #ef4444; color: white;">Last Out (3) Name</th>
                                <th style="width: 120px; background: #ef4444; color: white; border-right: 3px solid #dc2626;">Last Out (3) Amount</th>
                                <th style="width: 80px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyLastInOut">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Operator Report Tab -->
            <div id="contentOperatorReport" class="hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h3 class="section-title text-2xl">Operator Report</h3>
                    <button class="btn-success text-lg px-6 py-3" onclick="openAddPopup('operatorReport')">
                        <i class="fas fa-plus mr-2"></i>Add Data
                    </button>
                </div>
                
                <!-- Handler Summary Table -->
                <div class="mb-6">
                    <div style="background: white; border-radius: 8px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center;">
                            <h4 style="font-weight: 600; font-size: 18px; color: #374151;">Handler Summary</h4>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <label style="font-weight: 500; color: #6b7280;">Filter Month:</label>
                                <select id="handlerMonthFilter" onchange="renderHandlerSummary()" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px;">
                                    <option value="all">All Months</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table" id="tableHandlerSummary" style="width: 100%;">
                            <thead>
                                <tr style="background: #dc2626;">
                                    <th style="width: 200px; color: white;">Handler</th>
                                    <th style="width: 200px; color: white;">Amount</th>
                                    <th style="width: 150px; color: white;">1%</th>
                                    <th style="width: 150px; color: white;">2%</th>
                                    <th style="width: 150px; color: white;">3%</th>
                                    <th style="width: 150px; color: white;">Month</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyHandlerSummary">
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="data-table-container" style="max-height: 500px; overflow-y: auto;">
                    <table class="data-table" id="tableOperatorReport">
                        <thead>
                            <tr>
                                <th style="width: 160px;">Date & Time</th>
                                <th style="width: 120px;">Bank Name</th>
                                <th style="width: 150px;">Holder Name</th>
                                <th style="width: 150px;">Acc Number</th>
                                <th style="width: 100px;">Device</th>
                                <th style="width: 150px;">Handler</th>
                                <th style="width: 150px;">Transfer Out Balance</th>
                                <th style="width: 200px;">Attachment</th>
                                <th style="width: 80px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyOperatorReport">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Template Tab -->
            <div id="contentTemplate" class="hidden">
                <div class="mb-4">
                    <h3 class="section-title text-2xl">Account Information Lookup</h3>
                    <p class="text-gray-600 mt-2">Enter account number to view complete transaction details</p>
                </div>
                
                <!-- Search Section -->
                <div style="background: white; padding: 24px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 24px;">
                    <div style="display: flex; gap: 16px; align-items: end;">
                        <div style="flex: 1; max-width: 400px;">
                            <label style="display: block; font-weight: 600; color: #dc2626; margin-bottom: 8px; font-size: 14px;">
                                <i class="fas fa-search"></i> Input bank account number here â†´
                            </label>
                            <input type="text" id="templateAccountSearch" 
                                style="width: 100%; padding: 12px 16px; border: 2px solid #d1d5db; border-radius: 8px; font-size: 16px; transition: all 0.3s;"
                                onkeyup="searchAccountTemplate(event)"
                                onfocus="this.style.borderColor='#3b82f6'"
                                onblur="this.style.borderColor='#d1d5db'">
                        </div>
                        <button onclick="searchAccountTemplate()" style="padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                            <i class="fas fa-search mr-2"></i>Search
                        </button>
                        <button onclick="clearTemplateSearch()" style="padding: 12px 24px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
                            <i class="fas fa-times mr-2"></i>Clear
                        </button>
                    </div>
                    <div id="templateSearchMessage" style="margin-top: 12px; font-size: 14px; color: #6b7280;"></div>
                </div>
                
                <!-- Results Section -->
                <div id="templateResults" style="display: none;">
                    <!-- Account Info Table -->
                    <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 24px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tbody id="templateAccountInfo">
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Transaction Tables -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <!-- Last In Table -->
                        <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;">
                            <div style="background: #10b981; color: white; padding: 12px 16px; font-weight: 600; font-size: 16px;">
                                <i class="fas fa-arrow-down mr-2"></i>Last In Transactions
                            </div>
                            <table style="width: 100%; border-collapse: collapse;">
                                <tbody id="templateLastIn">
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Last Out Table -->
                        <div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;">
                            <div style="background: #ef4444; color: white; padding: 12px 16px; font-weight: 600; font-size: 16px;">
                                <i class="fas fa-arrow-up mr-2"></i>Last Out Transactions
                            </div>
                            <table style="width: 100%; border-collapse: collapse;">
                                <tbody id="templateLastOut">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- No Results Message -->
                <div id="templateNoResults" style="display: none; text-align: center; padding: 60px; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <i class="fas fa-search" style="font-size: 64px; color: #d1d5db; margin-bottom: 16px;"></i>
                    <h3 style="font-size: 20px; color: #374151; margin-bottom: 8px;">No Account Found</h3>
                    <p style="color: #6b7280;">Please enter a valid account number to view transaction details.</p>
                </div>
            </div>

        </div>
    </div>

    <!-- Add Data Popup Modal -->
    <div id="addDataModal" class="popup-modal">
        <div class="popup-content">
            <div class="popup-header">
                <h3 class="popup-title" id="popupTitle">Add New Data</h3>
                <button class="popup-close" onclick="closeAddPopup()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addDataForm" onsubmit="saveFormData(event)">
                <div class="form-grid" id="formFields">
                    <!-- Form fields will be inserted here dynamically -->
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeAddPopup()">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                    <button type="submit" class="btn-save">
                        <i class="fas fa-save mr-2"></i>Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Notification -->
    <div id="successNotification" class="success-notification">
        <i class="fas fa-check-circle mr-2"></i>
        <span id="successMessage">Data saved successfully!</span>
    </div>

    <script>
        // Global Variables
        let currentDatabase = null;
        let currentRole = null;
        
        // Data Storage for each database

        // ðŸ”¥ FIREBASE REAL-TIME SYNC FUNCTIONS
        
        // Load data from Firebase
        function loadFromFirebase() {
            console.log("ðŸ”„ Loading data from Firebase...");
            
            ['SGD', 'MYR', 'KHR'].forEach(dbName => {
                const tables = ['stockEmail', 'accDetails', 'accStatusCheck', 'bankFollowUp', 'lastInOut', 'operatorReport'];
                
                tables.forEach(tableName => {
                    database.ref(`databases/${dbName}/${tableName}`).on('value', (snapshot) => {
                        const data = snapshot.val();
                        
                        if (data) {
                            // Convert Firebase object to array
                            databases[dbName][tableName] = Object.values(data);
                        } else {
                            // Keep initial sample data if Firebase is empty
                            console.log(`No data in Firebase for ${dbName}/${tableName}, using initial data`);
                        }
                        
                        // Re-render if currently viewing this database/table
                        if (currentDatabase === dbName) {
                            renderAllTables();
                            updateDashboard();
                        }
                    });
                });
            });
            
            console.log("âœ… Firebase listeners attached!");
        }
        
        // Save to Firebase
        function saveToFirebase(dbName, tableName, data) {
            const ref = database.ref(`databases/${dbName}/${tableName}`);
            
            // Convert array to object with IDs as keys
            const dataObject = {};
            data.forEach(item => {
                dataObject[item.id] = item;
            });
            
            ref.set(dataObject)
                .then(() => {
                    console.log(`âœ… Saved ${tableName} to Firebase`);
                })
                .catch((error) => {
                    console.error(`âŒ Error saving to Firebase:`, error);
                });
        }
        
        // Initialize Firebase data (one-time upload of initial data)
        function initializeFirebaseData() {
            console.log("ðŸ“¤ Uploading initial data to Firebase...");
            
            ['SGD', 'MYR', 'KHR'].forEach(dbName => {
                Object.keys(databases[dbName]).forEach(tableName => {
                    saveToFirebase(dbName, tableName, databases[dbName][tableName]);
                });
            });
            
            console.log("âœ… Initial data uploaded!");
        }
        
        const databases = {
            SGD: {
                stockEmail: [
                    { id: 1001, date: '2024-12-20', email: 'john.doe@email.com', password: 'pass123', numberPhone: '+65 9123 4567', device: 'D001', assign: 'SGD', status: 'Used' },
                    { id: 1002, date: '2024-12-21', email: 'jane.smith@email.com', password: 'pass456', numberPhone: '+60 12345 6789', device: 'D002', assign: 'MYR', status: 'New' },
                    { id: 1003, date: '2024-12-22', email: 'bob.wilson@email.com', password: 'pass789', numberPhone: '+855 12 345 678', device: 'D003', assign: 'KHR', status: 'Used' },
                    { id: 1004, date: '2024-12-23', email: 'alice.brown@email.com', password: 'pass321', numberPhone: '+65 8765 4321', device: 'D004', assign: 'SGD', status: 'Suspend' }
                ],
                accDetails: [
                    { id: 1, bankName: 'Mari Bank', holderName: 'Rusli anak hartawan dari kampung sebelah', accNumber: '0239383474', source: 'WI', device: 'F141', assign: 'STORE', status: 'Su', startDate: '2024-12-09', endDate: '2024-12-25', username: 'Hasan', bankPW: '415321', email: 'nictra@gmail.com', passEmail: 'Qwer1234', vpn: '9008', agentName: 'Rosham' },
                    { id: 2, bankName: 'DBS/POSB', holderName: 'Nic suka nyodok tra ndak tau malu', accNumber: '783723879824', source: 'WI', device: 'F54', assign: 'STORE', status: 'Active', startDate: '2025-12-24', endDate: '', username: '', bankPW: '147369', email: 'crsnnexmax@gmail.com', passEmail: 'Qwer1244', vpn: '858575929293', agentName: 'Rosham' },
                    { id: 3, bankName: 'GXS Bank', holderName: 'Ahmad Abdullah', accNumber: '1122334455', source: 'SG', device: 'F55', assign: 'M24SG', status: 'Active', startDate: '2024-11-15', endDate: '', username: 'ahmad123', bankPW: '987654', email: 'ahmad@gmail.com', passEmail: 'Pass5678', vpn: '9009', agentName: 'David' }
                ],
                accStatusCheck: [
                    { id: 1, holderName: 'Rusli anak hartawan', group: 'Normal', paymentRent: '500', agent: 'M24SG', totalReceive: '5000', balance: '4500', lost: '0', status: 'Balance cleared', remark: 'All good', month: 'December' },
                    { id: 2, holderName: 'Ahmad Abdullah', group: 'Store Bank', paymentRent: '300', agent: 'ABSG', totalReceive: '3000', balance: '2700', lost: '0', status: 'Balance In Progress', remark: 'Processing', month: 'December' }
                ],
                bankFollowUp: [
                    { id: 1, dateIssues: '2024-12-20', bankName: 'Mari Bank', holderName: 'Rusli', accNumber: '0239383474', device: 'F141', issuesDesc: 'Login problem', status: 'Pending', handler: 'Danial', totalLostBalance: '0', totalRecoverBalance: '0', remark: 'Under investigation' },
                    { id: 2, dateIssues: '2024-12-21', bankName: 'GXS Bank', holderName: 'Ahmad', accNumber: '1122334455', device: 'F55', issuesDesc: 'Account suspended', status: 'In Progress', handler: 'Yulita', totalLostBalance: '500', totalRecoverBalance: '0', remark: 'Contacting bank' }
                ],
                lastInOut: [
                    { id: 1, dateIssues: '2024-12-20', bankName: 'Mari Bank', holderName: 'Rusli', accNumber: '0239383474', lastBalance: '0', issues: 'Login problem',
                        lastIn1Date: '2024-12-15', lastIn1Name: 'Payment A', lastIn1Amount: '1000',
                        lastIn2Date: '2024-12-10', lastIn2Name: 'Payment B', lastIn2Amount: '1500',
                        lastIn3Date: '2024-12-05', lastIn3Name: 'Payment C', lastIn3Amount: '2000',
                        lastOut1Date: '2024-12-18', lastOut1Name: 'Withdrawal A', lastOut1Amount: '500',
                        lastOut2Date: '2024-12-12', lastOut2Name: 'Withdrawal B', lastOut2Amount: '300',
                        lastOut3Date: '2024-12-08', lastOut3Name: 'Withdrawal C', lastOut3Amount: '200' }
                ],
                operatorReport: [
                    { id: 1, dateTime: '2024-12-20T10:30', bankName: 'Mari Bank', holderName: 'Rusli', accNumber: '0239383474', device: 'F141', handler: 'Danial', transferOutBalance: '500', attachment: 'receipt.pdf' },
                    { id: 2, dateTime: '2024-12-21T14:15', bankName: 'DBS/POSB', holderName: 'Ahmad', accNumber: '1234567890', device: 'F142', handler: 'Yulita', transferOutBalance: '750', attachment: 'receipt2.pdf' },
                    { id: 3, dateTime: '2024-12-22T09:45', bankName: 'GXS Bank', holderName: 'Siti', accNumber: '9876543210', device: 'F143', handler: 'Danial', transferOutBalance: '1000', attachment: 'receipt3.pdf' }
                ]
            },
            MYR: {
                stockEmail: [
                    { id: 1001, date: '2024-12-20', email: 'john.doe@email.com', password: 'pass123', numberPhone: '+65 9123 4567', device: 'D001', assign: 'SGD', status: 'Used' },
                    { id: 1002, date: '2024-12-21', email: 'jane.smith@email.com', password: 'pass456', numberPhone: '+60 12345 6789', device: 'D002', assign: 'MYR', status: 'New' },
                    { id: 1003, date: '2024-12-22', email: 'bob.wilson@email.com', password: 'pass789', numberPhone: '+855 12 345 678', device: 'D003', assign: 'KHR', status: 'Used' },
                    { id: 1004, date: '2024-12-23', email: 'alice.brown@email.com', password: 'pass321', numberPhone: '+65 8765 4321', device: 'D004', assign: 'SGD', status: 'Suspend' }
                ],
                accDetails: [
                    { id: 1, bankName: 'May Bank', holderName: 'Ahmad bin Hassan', accNumber: 'MYR001234567', source: '', device: 'M101', assign: '', status: 'Active', startDate: '2024-11-01', endDate: '', username: 'ahmad', bankPW: '789012', email: 'ahmad@gmail.com', passEmail: 'Pass1234', vpn: '7001', agentName: 'Siti' },
                    { id: 2, bankName: 'CIMB', holderName: 'Fatimah Abdullah', accNumber: 'MYR987654321', source: '', device: 'M102', assign: '', status: 'Active', startDate: '2024-10-15', endDate: '', username: 'fatimah', bankPW: '456789', email: 'fatimah@gmail.com', passEmail: 'Pass5678', vpn: '7002', agentName: 'Hassan' }
                ],
                accStatusCheck: [
                    { id: 1, holderName: 'Ahmad bin Hassan', group: 'Normal', paymentRent: '400', agent: 'M24SG', totalReceive: '4000', balance: '3600', lost: '0', status: 'Balance cleared', remark: 'Good', month: 'December' },
                    { id: 2, holderName: 'Fatimah Abdullah', group: 'Store Bank', paymentRent: '350', agent: 'ABSG', totalReceive: '3500', balance: '3150', lost: '0', status: 'Balance In Progress', remark: 'Processing', month: 'December' }
                ],
                bankFollowUp: [
                    { id: 1, dateIssues: '2024-12-20', bankName: 'May Bank', holderName: 'Ahmad', accNumber: 'MYR001234567', device: 'M101', issuesDesc: 'Transaction issue', status: 'Pending', handler: 'Danial', totalLostBalance: '0', totalRecoverBalance: '0', remark: 'Checking' }
                ],
                lastInOut: [
                    { id: 1, dateIssues: '2024-12-20', bankName: 'May Bank', holderName: 'Ahmad', accNumber: 'MYR001234567', lastBalance: '0', issues: 'Transaction issue',
                        lastIn1Date: '2024-12-15', lastIn1Name: 'Transfer A', lastIn1Amount: '800',
                        lastIn2Date: '2024-12-10', lastIn2Name: 'Transfer B', lastIn2Amount: '1200',
                        lastIn3Date: '2024-12-05', lastIn3Name: 'Transfer C', lastIn3Amount: '1500',
                        lastOut1Date: '2024-12-18', lastOut1Name: 'Payment A', lastOut1Amount: '400',
                        lastOut2Date: '2024-12-12', lastOut2Name: 'Payment B', lastOut2Amount: '250',
                        lastOut3Date: '2024-12-08', lastOut3Name: 'Payment C', lastOut3Amount: '180' }
                ],
                operatorReport: [
                    { id: 1, dateTime: '2024-12-20T11:30', bankName: 'May Bank', holderName: 'Ahmad', accNumber: 'MYR001234567', device: 'M101', handler: 'Danial', transferOutBalance: '600', attachment: 'myr-receipt1.pdf' },
                    { id: 2, dateTime: '2024-12-21T15:45', bankName: 'CIMB', holderName: 'Fatimah', accNumber: 'MYR987654321', device: 'M102', handler: 'Yulita', transferOutBalance: '850', attachment: 'myr-receipt2.pdf' }
                ]
            },
            KHR: {
                stockEmail: [
                    { id: 1001, date: '2024-12-20', email: 'john.doe@email.com', password: 'pass123', numberPhone: '+65 9123 4567', device: 'D001', assign: 'SGD', status: 'Used' },
                    { id: 1002, date: '2024-12-21', email: 'jane.smith@email.com', password: 'pass456', numberPhone: '+60 12345 6789', device: 'D002', assign: 'MYR', status: 'New' },
                    { id: 1003, date: '2024-12-22', email: 'bob.wilson@email.com', password: 'pass789', numberPhone: '+855 12 345 678', device: 'D003', assign: 'KHR', status: 'Used' },
                    { id: 1004, date: '2024-12-23', email: 'alice.brown@email.com', password: 'pass321', numberPhone: '+65 8765 4321', device: 'D004', assign: 'SGD', status: 'Suspend' }
                ],
                accDetails: [
                    { id: 1, bankName: 'ABA Bank', holderName: 'Sokha Chea', accNumber: 'KHR123456789', source: '', device: 'K201', assign: '', status: 'Active', startDate: '2024-11-05', endDate: '', username: 'sokha', bankPW: '321654', email: 'sokha@gmail.com', passEmail: 'Pass9012', vpn: '8001', agentName: 'Dara' },
                    { id: 2, bankName: 'Wings Bank', holderName: 'Vanna Lim', accNumber: 'KHR987654321', source: '', device: 'K202', assign: '', status: 'Active', startDate: '2024-10-20', endDate: '', username: 'vanna', bankPW: '654987', email: 'vanna@gmail.com', passEmail: 'Pass3456', vpn: '8002', agentName: 'Kimly' }
                ],
                accStatusCheck: [
                    { id: 1, holderName: 'Sokha Chea', group: 'Big Bank', paymentRent: '300', agent: 'OXSG', totalReceive: '3000', balance: '2700', lost: '0', status: 'Balance cleared', remark: 'Completed', month: 'December' },
                    { id: 2, holderName: 'Vanna Lim', group: 'Normal', paymentRent: '250', agent: 'FWSG', totalReceive: '2500', balance: '2250', lost: '0', status: 'Balance refunded', remark: 'Refunded', month: 'December' }
                ],
                bankFollowUp: [
                    { id: 1, dateIssues: '2024-12-20', bankName: 'ABA Bank', holderName: 'Sokha', accNumber: 'KHR123456789', device: 'K201', issuesDesc: 'Account verification', status: 'In Progress', handler: 'Yulita', totalLostBalance: '0', totalRecoverBalance: '0', remark: 'In progress' }
                ],
                lastInOut: [
                    { id: 1, dateIssues: '2024-12-20', bankName: 'ABA Bank', holderName: 'Sokha', accNumber: 'KHR123456789', lastBalance: '0', issues: 'Account verification',
                        lastIn1Date: '2024-12-15', lastIn1Name: 'Deposit A', lastIn1Amount: '600',
                        lastIn2Date: '2024-12-10', lastIn2Name: 'Deposit B', lastIn2Amount: '900',
                        lastIn3Date: '2024-12-05', lastIn3Name: 'Deposit C', lastIn3Amount: '1100',
                        lastOut1Date: '2024-12-18', lastOut1Name: 'Withdraw A', lastOut1Amount: '300',
                        lastOut2Date: '2024-12-12', lastOut2Name: 'Withdraw B', lastOut2Amount: '200',
                        lastOut3Date: '2024-12-08', lastOut3Name: 'Withdraw C', lastOut3Amount: '150' }
                ],
                operatorReport: [
                    { id: 1, dateTime: '2024-12-20T13:00', bankName: 'ABA Bank', holderName: 'Sokha', accNumber: 'KHR123456789', device: 'K201', handler: 'Danial', transferOutBalance: '400', attachment: 'khr-receipt1.pdf' },
                    { id: 2, dateTime: '2024-12-21T16:30', bankName: 'Wings Bank', holderName: 'Vanna', accNumber: 'KHR987654321', device: 'K202', handler: 'Yulita', transferOutBalance: '550', attachment: 'khr-receipt2.pdf' }
                ]
            }
        };

        let currentFormType = null;
        
        // Get Bank Names based on current database
        function getBankNamesByDatabase() {
            const bankNames = {
                SGD: ['Liquidpay', 'Mari Bank', 'DBS/POSB', 'GXS Bank', 'Trust Bank', 'May Bank', 'CIMB', 'CORP Mari', 'CORP DBS/POSB', 'CORP GXS', 'CORP CIMB'],
                MYR: ['May Bank', 'RHB Bank', 'HLB Bank', 'CIMB'],
                KHR: ['ABA Bank', 'Wings Bank', 'Acelda Bank']
            };
            return bankNames[currentDatabase] || bankNames.SGD;
        }
        
        // Get Sources based on current database
        function getSourcesByDatabase() {
            if (currentDatabase === 'SGD') {
                return ['Wealth+', 'SG', 'KB', 'JH', 'SENG', 'GP', 'WT', 'David', 'TIGER'];
            } else if (currentDatabase === 'MYR') {
                return ['Wealth+'];
            } else if (currentDatabase === 'KHR') {
                return ['Wealth+'];
            }
            return [];
        }
        
        // Get Assigns based on current database
        function getAssignsByDatabase() {
            if (currentDatabase === 'SGD') {
                return ['M24SG', 'ABSG', 'OXSG', 'FWSG', 'OK188SG', 'WBSG', 'Store', 'Big Bank', 'Back Up Bank'];
            } else if (currentDatabase === 'MYR') {
                return ['JMMY'];
            } else if (currentDatabase === 'KHR') {
                return ['CAM788'];
            }
            return [];
        }
        
        // Populate Bank Name filters based on current database
        function populateBankFilters() {
            const banks = getBankNamesByDatabase();
            
            // Update Acc Details filter
            const filterAccDetailsBank = document.getElementById('filterAccDetailsBank');
            if (filterAccDetailsBank) {
                filterAccDetailsBank.innerHTML = '<option value="all">All Banks</option>';
                banks.forEach(bank => {
                    const option = document.createElement('option');
                    option.value = bank;
                    option.textContent = bank;
                    filterAccDetailsBank.appendChild(option);
                });
            }
            
            // Update Bank Issues filter
            const filterBankIssuesBank = document.getElementById('filterBankIssuesBank');
            if (filterBankIssuesBank) {
                filterBankIssuesBank.innerHTML = '<option value="all">All Banks</option>';
                banks.forEach(bank => {
                    const option = document.createElement('option');
                    option.value = bank;
                    option.textContent = bank;
                    filterBankIssuesBank.appendChild(option);
                });
            }
        }

        // Open Add Popup
        function openAddPopup(tableName) {
            currentFormType = tableName;
            const modal = document.getElementById('addDataModal');
            const formFields = document.getElementById('formFields');
            const popupTitle = document.getElementById('popupTitle');
            
            // Set title
            const titles = {
                stockEmail: 'Add Stock Email',
                accDetails: 'Add Account Details',
                accStatusCheck: 'Add Account Status Check',
                bankFollowUp: 'Add Bank Issue',
                lastInOut: 'Add Last In Out Transaction',
                operatorReport: 'Add Operator Report'
            };
            popupTitle.textContent = titles[tableName];
            
            // Generate form fields
            formFields.innerHTML = getFormFields(tableName);
            
            // Load custom options from localStorage for all dropdowns with + button
            setTimeout(() => {
                loadCustomOptions('assignStockEmail', 'assignStockEmailSelect');
                loadCustomOptions('statusStockEmail', 'statusStockEmailSelect');
                loadCustomOptions('groupAccStatus', 'groupAccStatusSelect');
                loadCustomOptions('agentAccStatus', 'agentAccStatusSelect');
                loadCustomOptions('monthAccStatus', 'monthAccStatusSelect');
                loadCustomOptions('statusAccStatus', 'statusAccStatusSelect');
                loadCustomOptions('statusBankIssues', 'statusBankIssuesSelect');
                loadCustomOptions('handlerBankIssues', 'handlerBankIssuesSelect');
                loadCustomOptions('issuesDescBankIssues', 'issuesDescBankIssuesSelect');
                loadCustomOptions('bankNameBankIssues', 'bankNameBankIssuesSelect');
                loadCustomOptions('bankNameOperator', 'bankNameOperatorSelect');
                loadCustomOptions('handlerOperator', 'handlerOperatorSelect');
            }, 100);
            
            // Show modal
            modal.classList.add('active');
        }

        // Close Add Popup
        function closeAddPopup() {
            const modal = document.getElementById('addDataModal');
            modal.classList.remove('active');
            document.getElementById('addDataForm').reset();
        }

        // Get Form Fields based on table type
        function getFormFields(tableName) {
            const today = new Date().toISOString().split('T')[0];
            const thisMonth = new Date().toLocaleString('default', { month: 'long' });
            
            let fields = '';
            
            switch(tableName) {
                case 'stockEmail':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="date" name="date" class="form-input" value="${today}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" name="email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="text" name="password" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number Phone</label>
                            <input type="text" name="numberPhone" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Device</label>
                            <input type="text" name="device" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <div class="label-with-button">
                                <label class="form-label">Assign</label>
                                <button type="button" class="add-option-btn" onclick="addNewOption('assignStockEmail')">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <select name="assign" id="assignStockEmailSelect" class="form-input" required>
                                <option value="">Select Assign</option>
                                <option value="SGD" style="color: #ef4444; font-weight: 600;">ðŸ”´ SGD</option>
                                <option value="MYR" style="color: #f97316; font-weight: 600;">ðŸŸ  MYR</option>
                                <option value="KHR" style="color: #3b82f6; font-weight: 600;">ðŸ”µ KHR</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="label-with-button">
                                <label class="form-label">Status</label>
                                <button type="button" class="add-option-btn" onclick="addNewOption('statusStockEmail')">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <select name="status" id="statusStockEmailSelect" class="form-input" required>
                                <option value="">Select Status</option>
                                <option value="Used" style="color: #10b981; font-weight: 600;">âœ“ Used</option>
                                <option value="New" style="color: #3b82f6; font-weight: 600;">â˜… New</option>
                                <option value="Suspend" style="color: #ef4444; font-weight: 600;">âœ— Suspend</option>
                            </select>
                        </div>
                    `;
                    break;
                    
                case 'accDetails':
                    const bankNames = getBankNamesByDatabase();
                    const sources = getSourcesByDatabase();
                    const assigns = getAssignsByDatabase();
                    
                    let bankOptions = '<option value="">Select Bank</option>';
                    bankNames.forEach(bank => {
                        bankOptions += `<option value="${bank}">${bank}</option>`;
                    });
                    
                    let sourceOptions = '', sourceRequired = '', sourceButton = '';
                    if (sources.length > 0) {
                        sourceOptions = '<option value="">Select Source</option>';
                        sources.forEach(s => { sourceOptions += `<option value="${s}">${s}</option>`; });
                        sourceRequired = 'required';
                        sourceButton = '<button type="button" onclick="addNewOption(&quot;source&quot;)" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;"><i class="fas fa-plus"></i></button>';
                    } else {
                        sourceOptions = '<option value="">No options - Add manually</option>';
                    }
                    
                    let assignOptions = '', assignRequired = '', assignButton = '';
                    if (assigns.length > 0) {
                        assignOptions = '<option value="">Select Assign</option>';
                        assigns.forEach(a => { assignOptions += `<option value="${a}">${a}</option>`; });
                        assignRequired = 'required';
                        assignButton = '<button type="button" onclick="addNewOption(&quot;assign&quot;)" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;"><i class="fas fa-plus"></i></button>';
                    } else {
                        assignOptions = '<option value="">No options - Add manually</option>';
                    }
                    
                    fields = `
                        <div class="form-group">
                            <label class="form-label">
                                Bank Name
                                <button type="button" onclick="addNewOption('bankName')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="bankName" id="bankNameSelect" class="form-input" required>
                                ${bankOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Holder Name</label>
                            <input type="text" name="holderName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Number</label>
                            <input type="text" name="accNumber" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Source
                                ${sourceButton}
                            </label>
                            <select name="source" id="sourceSelect" class="form-input" ${sourceRequired}>
                                ${sourceOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Device</label>
                            <input type="text" name="device" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Assign
                                ${assignButton}
                            </label>
                            <select name="assign" id="assignSelect" class="form-input" ${assignRequired}>
                                ${assignOptions}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Status
                                <button type="button" onclick="addNewOption('status')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="status" id="statusSelect" class="form-input" required>
                                <option value="">Select Status</option>
                                <option value="Active" style="color: #10b981; font-weight: 600;">ðŸŸ¢ Active</option>
                                <option value="Suspend" style="color: #ef4444; font-weight: 600;">ðŸ”´ Suspend</option>
                                <option value="Stopped" style="color: #1f2937; font-weight: 600;">âš« Stopped</option>
                                <option value="On Hold" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ On Hold</option>
                                <option value="Cooling period" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ Cooling period</option>
                                <option value="Login Error" style="color: #ef4444; font-weight: 600;">ðŸ”´ Login Error</option>
                                <option value="Email Error" style="color: #ef4444; font-weight: 600;">ðŸ”´ Email Error</option>
                                <option value="Bank Reach Limit" style="color: #1f2937; font-weight: 600;">âš« Bank Reach Limit</option>
                                <option value="Bank Owner Used" style="color: #ef4444; font-weight: 600;">ðŸ”´ Bank Owner Used</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Remark</label>
                            <textarea name="remark" class="form-input" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Start Date</label>
                            <input type="date" name="startDate" class="form-input" value="${today}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Date</label>
                            <input type="date" name="endDate" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" name="username" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bank PW/PIN</label>
                            <input type="text" name="bankPW" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" name="email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Password</label>
                            <input type="text" name="passEmail" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">VPN</label>
                            <input type="text" name="vpn" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Agent Name</label>
                            <input type="text" name="agentName" class="form-input" required>
                        </div>
                    `;
                    break;
                    
                case 'accStatusCheck':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Holder Name</label>
                            <input type="text" name="holderName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Group
                                <button type="button" onclick="addNewOption('groupAccStatus')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="group" id="groupAccStatusSelect" class="form-input" required>
                                <option value="">Select Group</option>
                                <option value="Normal">Normal</option>
                                <option value="Store Bank">Store Bank</option>
                                <option value="Big Bank">Big Bank</option>
                                <option value="Back Up Bank">Back Up Bank</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Rent</label>
                            <input type="number" name="paymentRent" class="form-input" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Agent
                                <button type="button" onclick="addNewOption('agentAccStatus')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="agent" id="agentAccStatusSelect" class="form-input" required>
                                <option value="">Select Agent</option>
                                ${currentDatabase === 'SGD' ? `
                                    <option value="M24SG">M24SG</option>
                                    <option value="ABSG">ABSG</option>
                                    <option value="OXSG">OXSG</option>
                                    <option value="FWSG">FWSG</option>
                                    <option value="OK188SG">OK188SG</option>
                                    <option value="WBSG">WBSG</option>
                                    <option value="Others">Others</option>
                                ` : currentDatabase === 'MYR' ? `
                                    <option value="SBMY">SBMY</option>
                                ` : currentDatabase === 'KHR' ? `
                                    <option value="CAM788">CAM788</option>
                                ` : ''}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Total Receive</label>
                            <input type="number" name="totalReceive" class="form-input" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Balance</label>
                            <input type="number" name="balance" class="form-input" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lost</label>
                            <input type="number" name="lost" class="form-input" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Status
                                <button type="button" onclick="addNewOption('statusAccStatus')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="status" id="statusAccStatusSelect" class="form-input" required>
                                <option value="">Select Status</option>
                                <option value="Balance cleared" style="color: #9333ea; font-weight: 600;">ðŸŸ£ Balance cleared</option>
                                <option value="Balance refunded" style="color: #9333ea; font-weight: 600;">ðŸŸ£ Balance refunded</option>
                                <option value="Balance In Progress" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ Balance In Progress</option>
                                <option value="Bank Owner Used" style="color: #ef4444; font-weight: 600;">ðŸ”´ Bank Owner Used</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Month
                                <button type="button" onclick="addNewOption('monthAccStatus')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="month" id="monthAccStatusSelect" class="form-input" required>
                                <option value="">Select Month</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">Remark</label>
                            <textarea name="remark" class="form-input" rows="3"></textarea>
                        </div>
                    `;
                    break;
                    
                case 'bankFollowUp':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Date Issues</label>
                            <input type="date" name="dateIssues" class="form-input" value="${today}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Bank Name
                                <button type="button" onclick="addNewOption('bankNameBankIssues')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="bankName" id="bankNameBankIssuesSelect" class="form-input" required>
                                <option value="">Select Bank</option>
                                ${getBankNamesByDatabase().map(bank => `<option value="${bank}">${bank}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Holder Name</label>
                            <input type="text" name="holderName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Number</label>
                            <input type="text" name="accNumber" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Device</label>
                            <input type="text" name="device" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Status
                                <button type="button" onclick="addNewOption('statusBankIssues')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="status" id="statusBankIssuesSelect" class="form-input" required>
                                <option value="">Select Status</option>
                                <option value="Pending" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ Pending</option>
                                <option value="In Progress" style="color: #f59e0b; font-weight: 600;">ðŸŸ¡ In Progress</option>
                                <option value="Success" style="color: #10b981; font-weight: 600;">ðŸŸ¢ Success</option>
                                <option value="Resolved" style="color: #10b981; font-weight: 600;">ðŸŸ¢ Resolved</option>
                                <option value="Failed" style="color: #ef4444; font-weight: 600;">ðŸ”´ Failed</option>
                                <option value="Closed" style="color: #1f2937; font-weight: 600;">âš« Closed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Handler
                                <button type="button" onclick="addNewOption('handlerBankIssues')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="handler" id="handlerBankIssuesSelect" class="form-input" required>
                                <option value="">Select Handler</option>
                                <option value="Danial">Danial</option>
                                <option value="Yulita">Yulita</option>
                                <option value="Nich">Nich</option>
                                <option value="Wealth+">Wealth+</option>
                                <option value="PE">PE</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Total Lost Balance</label>
                            <input type="number" name="totalLostBalance" class="form-input" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Total Recover Balance</label>
                            <input type="number" name="totalRecoverBalance" class="form-input" step="0.01">
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">
                                Issues Description
                                <button type="button" onclick="addNewOption('issuesDescBankIssues')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="issuesDesc" id="issuesDescBankIssuesSelect" class="form-input" required>
                                <option value="">Select Issue</option>
                                <option value="Bank Suspend">Bank Suspend</option>
                                <option value="Can't receive money">Can't receive money</option>
                                <option value="Login issue need calling cs bank">Login issue need calling cs bank</option>
                                <option value="Can't out money">Can't out money</option>
                                <option value="Bank owner use">Bank owner use</option>
                                <option value="Stop forwarding email">Stop forwarding email</option>
                                <option value="Incorrect password">Incorrect password</option>
                                <option value="Can't login annual limit approaching">Can't login annual limit approaching</option>
                                <option value="Stopped annual limit completed">Stopped annual limit completed</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">Remark</label>
                            <textarea name="remark" class="form-input" rows="3"></textarea>
                        </div>
                    `;
                    break;
                    
                case 'operatorReport':
                    fields = `
                        <div class="form-group">
                            <label class="form-label">Date & Time</label>
                            <input type="datetime-local" name="dateTime" class="form-input" value="${today}T${new Date().toTimeString().slice(0,5)}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Bank Name
                                <button type="button" onclick="addNewOption('bankNameOperator')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="bankName" id="bankNameOperatorSelect" class="form-input" required>
                                <option value="">Select Bank</option>
                                ${getBankNamesByDatabase().map(bank => `<option value="${bank}">${bank}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Holder Name</label>
                            <input type="text" name="holderName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Number</label>
                            <input type="text" name="accNumber" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Device</label>
                            <input type="text" name="device" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Handler
                                <button type="button" onclick="addNewOption('handlerOperator')" style="margin-left: 8px; background: #10b981; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </label>
                            <select name="handler" id="handlerOperatorSelect" class="form-input" required>
                                <option value="">Select Handler</option>
                                <option value="Danial">Danial</option>
                                <option value="Yulita">Yulita</option>
                                <option value="Nich">Nich</option>
                                <option value="Wealth+">Wealth+</option>
                                <option value="PE">PE</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Transfer Out Balance</label>
                            <input type="number" name="transferOutBalance" class="form-input" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Attachment</label>
                            <input type="text" name="attachment" class="form-input" required>
                        </div>
                    `;
                    break;
            }
            
            return fields;
        }

        // Save Form Data
        function saveFormData(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            if (editingRowId !== null) {
                // Editing existing row
                const rowIndex = databases[currentDatabase][currentFormType].findIndex(r => r.id === editingRowId);
                if (rowIndex > -1) {
                    databases[currentDatabase][currentFormType][rowIndex] = {
                        ...databases[currentDatabase][currentFormType][rowIndex],
                        ...data
                    };
                    
                    // If editing Stock Email, sync across all databases
                    if (currentFormType === 'stockEmail') {
                        syncStockEmailAcrossDatabases(editingRowId, data, 'update');
                    }
                    
                    // If editing Bank Issues, update corresponding Last In Out
                    if (currentFormType === 'bankFollowUp') {
                        updateLastInOutFromBankIssues(editingRowId, data);
                        // AUTO-UPDATE Acc Details Status based on Issues Description
                        autoUpdateAccDetailsStatus(data);
                    }
                    
                    showSuccessNotification('Data updated successfully!');
                }
                editingRowId = null;
            } else {
                // Adding new row
                data.id = Date.now();
                databases[currentDatabase][currentFormType].push(data);
                
                // If adding Stock Email, sync across all databases
                if (currentFormType === 'stockEmail') {
                    syncStockEmailAcrossDatabases(data.id, data, 'add');
                }
                
                // If adding Bank Issues, auto-create Last In Out entry
                if (currentFormType === 'bankFollowUp') {
                    createLastInOutFromBankIssues(data);
                    // AUTO-UPDATE Acc Details Status based on Issues Description
                    autoUpdateAccDetailsStatus(data);
                }
                
                showSuccessNotification('Data saved successfully!');
            }
            
            // Re-render table
            renderTable(currentFormType);
            if (currentFormType === 'bankFollowUp') {
                renderTable('lastInOut');
            }
            // Refresh handler summary if operator report was updated
            if (currentFormType === 'operatorReport') {
                renderHandlerSummary();
            }
            updateDashboard();
            
            // Close popup
            closeAddPopup();
        }
        
        // Sync Stock Email across all databases
        function syncStockEmailAcrossDatabases(id, data, action) {
            const allDatabases = ['SGD', 'MYR', 'KHR'];
            
            allDatabases.forEach(db => {
                if (db === currentDatabase) return; // Skip current database
                
                if (action === 'add') {
                    // Add to other databases
                    databases[db]['stockEmail'].push({
                        id: id,
                        date: data.date,
                        email: data.email,
                        password: data.password,
                        numberPhone: data.numberPhone,
                        device: data.device,
                        assign: data.assign,
                        status: data.status
                    });
                } else if (action === 'update') {
                    // Update in other databases
                    const rowIndex = databases[db]['stockEmail'].findIndex(r => r.id === id);
                    if (rowIndex > -1) {
                        databases[db]['stockEmail'][rowIndex] = {
                            ...databases[db]['stockEmail'][rowIndex],
                            date: data.date,
                            email: data.email,
                            password: data.password,
                            numberPhone: data.numberPhone,
                            device: data.device,
                            assign: data.assign,
                            status: data.status
                        };
                    } else {
                        // If not found, add it
                        databases[db]['stockEmail'].push({
                            id: id,
                            date: data.date,
                            email: data.email,
                            password: data.password,
                            numberPhone: data.numberPhone,
                            device: data.device,
                            assign: data.assign,
                            status: data.status
                        });
                    }
                } else if (action === 'delete') {
                    // Delete from other databases
                    const rowIndex = databases[db]['stockEmail'].findIndex(r => r.id === id);
                    if (rowIndex > -1) {
                        databases[db]['stockEmail'].splice(rowIndex, 1);
                    }
                }
            });
        }
        
        // Auto-create Last In Out from Bank Issues
        function createLastInOutFromBankIssues(bankIssue) {
            const lastInOutData = {
                id: bankIssue.id, // Use same ID to link them
                dateIssues: bankIssue.dateIssues,
                bankName: bankIssue.bankName,
                holderName: bankIssue.holderName,
                accNumber: bankIssue.accNumber,
                lastBalance: bankIssue.totalLostBalance || '0',
                issues: bankIssue.issuesDesc || '',
                lastIn1Date: '',
                lastIn1Name: '',
                lastIn1Amount: '',
                lastIn2Date: '',
                lastIn2Name: '',
                lastIn2Amount: '',
                lastIn3Date: '',
                lastIn3Name: '',
                lastIn3Amount: '',
                lastOut1Date: '',
                lastOut1Name: '',
                lastOut1Amount: '',
                lastOut2Date: '',
                lastOut2Name: '',
                lastOut2Amount: '',
                lastOut3Date: '',
                lastOut3Name: '',
                lastOut3Amount: ''
            };
            
            databases[currentDatabase]['lastInOut'].push(lastInOutData);
        }
        
        // Update Last In Out from Bank Issues
        function updateLastInOutFromBankIssues(bankIssueId, bankIssueData) {
            const lastInOutIndex = databases[currentDatabase]['lastInOut'].findIndex(r => r.id === bankIssueId);
            if (lastInOutIndex > -1) {
                // Update only the auto-populated fields, keep Last In/Out data
                databases[currentDatabase]['lastInOut'][lastInOutIndex] = {
                    ...databases[currentDatabase]['lastInOut'][lastInOutIndex],
                    dateIssues: bankIssueData.dateIssues,
                    bankName: bankIssueData.bankName,
                    holderName: bankIssueData.holderName,
                    accNumber: bankIssueData.accNumber,
                    lastBalance: bankIssueData.totalLostBalance || databases[currentDatabase]['lastInOut'][lastInOutIndex].lastBalance,
                    issues: bankIssueData.issuesDesc || databases[currentDatabase]['lastInOut'][lastInOutIndex].issues
                };
            }
        }
        
        // Auto-Update Acc Details Status based on Bank Issues Description
        function autoUpdateAccDetailsStatus(bankIssueData) {
            // Mapping: Issues Description -> Acc Details Status
            const suspendIssues = [
                'Bank Suspend',
                "Can't receive money",
                'Login issue need calling cs bank',
                "Can't out money"
            ];
            
            const stoppedIssues = [
                'Bank owner use',
                'Stop forwarding email',
                'Incorrect password',
                "Can't login annual limit approaching",
                'Stopped annual limit completed'
            ];
            
            // Determine new status based on Issues Description
            let newStatus = null;
            if (suspendIssues.includes(bankIssueData.issuesDesc)) {
                newStatus = 'Suspend';
            } else if (stoppedIssues.includes(bankIssueData.issuesDesc)) {
                newStatus = 'Stopped';
            }
            
            // If status should be updated, find and update the Acc Details entry
            if (newStatus) {
                const accDetailsData = databases[currentDatabase]['accDetails'];
                const accIndex = accDetailsData.findIndex(acc => 
                    acc.accNumber === bankIssueData.accNumber
                );
                
                if (accIndex > -1) {
                    // Update status AND End Date
                    databases[currentDatabase]['accDetails'][accIndex].status = newStatus;
                    databases[currentDatabase]['accDetails'][accIndex].endDate = bankIssueData.dateIssues;
                    
                    // Re-render Acc Details table if visible
                    renderTable('accDetails');
                    
                    console.log(`Auto-updated Acc Details status to "${newStatus}" and endDate to "${bankIssueData.dateIssues}" for account ${bankIssueData.accNumber}`);
                }
            }
        }

        // Show Success Notification
        function showSuccessNotification(message) {
            const notification = document.getElementById('successNotification');
            const messageEl = document.getElementById('successMessage');
            messageEl.textContent = message;
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        // Truncate text with tooltip
        function truncateText(text, maxLength = 20) {
            if (text && text.length > maxLength) {
                return `<span class="truncate-text" data-full-text="${text}">${text.substring(0, maxLength)}...</span>`;
            }
            return text || '';
        }

        // Add New Option to Dropdown
        let currentAddingFieldType = null;
        
        function addNewOption(fieldType, event) {
            // Prevent event bubbling to parent elements
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const labels = {
                bankName: 'Bank Name',
                source: 'Source',
                assign: 'Assign',
                status: 'Status',
                assignStockEmail: 'Assign (Stock Email)',
                statusStockEmail: 'Status (Stock Email)',
                groupAccStatus: 'Group (Acc Status)',
                agentAccStatus: 'Agent (Acc Status)',
                monthAccStatus: 'Month (Acc Status)',
                statusAccStatus: 'Status (Acc Status)',
                statusBankIssues: 'Status (Bank Issues)',
                handlerBankIssues: 'Handler (Bank Issues)',
                issuesDescBankIssues: 'Issues Description (Bank Issues)',
                bankNameBankIssues: 'Bank Name (Bank Issues)',
                bankNameOperator: 'Bank Name (Operator Report)',
                handlerOperator: 'Handler (Operator Report)'
            };
            
            currentAddingFieldType = fieldType;
            
            // Set field label
            document.getElementById('addOptionFieldLabel').textContent = labels[fieldType] || 'Option';
            
            // Clear input
            document.getElementById('addOptionInput').value = '';
            
            // Show modal
            document.getElementById('addOptionModal').style.display = 'flex';
            
            // Focus input
            setTimeout(() => {
                document.getElementById('addOptionInput').focus();
            }, 100);
            
            // Allow Enter key to save
            document.getElementById('addOptionInput').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    saveNewOption();
                }
            };
        }
        
        function closeAddOptionModal() {
            document.getElementById('addOptionModal').style.display = 'none';
            currentAddingFieldType = null;
        }
        
        function saveNewOption() {
            if (!currentAddingFieldType) return;
            
            const labels = {
                bankName: 'Bank Name',
                source: 'Source',
                assign: 'Assign',
                status: 'Status',
                assignStockEmail: 'Assign (Stock Email)',
                statusStockEmail: 'Status (Stock Email)',
                groupAccStatus: 'Group (Acc Status)',
                agentAccStatus: 'Agent (Acc Status)',
                monthAccStatus: 'Month (Acc Status)',
                statusAccStatus: 'Status (Acc Status)',
                statusBankIssues: 'Status (Bank Issues)',
                handlerBankIssues: 'Handler (Bank Issues)',
                issuesDescBankIssues: 'Issues Description (Bank Issues)',
                bankNameBankIssues: 'Bank Name (Bank Issues)',
                bankNameOperator: 'Bank Name (Operator Report)',
                handlerOperator: 'Handler (Operator Report)'
            };
            
            const newValue = document.getElementById('addOptionInput').value.trim();
            
            if (newValue === '') {
                alert('Please enter a value!');
                return;
            }
            
            const selectId = currentAddingFieldType + 'Select';
            const select = document.getElementById(selectId);
            
            if (select) {
                const option = document.createElement('option');
                option.value = newValue;
                option.textContent = newValue;
                
                // Add color for status options (Acc Details)
                if (currentAddingFieldType === 'status') {
                    const colorMap = {
                        'Active': '#10b981',
                        'Suspend': '#ef4444',
                        'Stopped': '#1f2937',
                        'On Hold': '#f59e0b',
                        'Cooling period': '#f59e0b',
                        'Login Error': '#ef4444',
                        'Email Error': '#ef4444',
                        'Bank Reach Limit': '#1f2937',
                        'Bank Owner Used': '#ef4444'
                    };
                    
                    option.style.color = colorMap[newValue] || '#000000';
                    option.style.fontWeight = '600';
                }
                
                // Add color for stock email status
                if (currentAddingFieldType === 'statusStockEmail') {
                    const colorMap = {
                        'Used': '#10b981',
                        'New': '#3b82f6',
                        'Suspend': '#ef4444'
                    };
                    
                    option.style.color = colorMap[newValue] || '#000000';
                    option.style.fontWeight = '600';
                }
                
                // Add color for stock email assign
                if (currentAddingFieldType === 'assignStockEmail') {
                    const colorMap = {
                        'SGD': '#ef4444',
                        'MYR': '#f97316',
                        'KHR': '#3b82f6'
                    };
                    
                    option.style.color = colorMap[newValue] || '#000000';
                    option.style.fontWeight = '600';
                }
                
                // Add color for Acc Status status
                if (currentAddingFieldType === 'statusAccStatus') {
                    const colorMap = {
                        'Balance cleared': '#9333ea',
                        'Balance refunded': '#9333ea',
                        'Balance In Progress': '#f59e0b',
                        'Bank Owner Used': '#ef4444'
                    };
                    
                    option.style.color = colorMap[newValue] || '#000000';
                    option.style.fontWeight = '600';
                }
                
                // Add color for Bank Issues status
                if (currentAddingFieldType === 'statusBankIssues') {
                    const colorMap = {
                        'Pending': '#f59e0b',
                        'In Progress': '#f59e0b',
                        'Success': '#10b981',
                        'Resolved': '#10b981',
                        'Failed': '#ef4444',
                        'Closed': '#1f2937'
                    };
                    
                    option.style.color = colorMap[newValue] || '#000000';
                    option.style.fontWeight = '600';
                }
                
                select.appendChild(option);
                select.value = newValue;
                
                // SAVE TO LOCALSTORAGE FOR PERSISTENCE
                saveCustomOption(currentAddingFieldType, newValue);
                
                showSuccessNotification(`New ${labels[currentAddingFieldType]} added successfully!`);
                
                closeAddOptionModal();
            }
        }
        
        // Save custom option to localStorage
        function saveCustomOption(fieldType, value) {
            const storageKey = `customOptions_${currentDatabase}_${fieldType}`;
            let options = JSON.parse(localStorage.getItem(storageKey) || '[]');
            if (!options.includes(value)) {
                options.push(value);
                localStorage.setItem(storageKey, JSON.stringify(options));
            }
        }
        
        // Load custom options from localStorage
        function loadCustomOptions(fieldType, selectId) {
            const storageKey = `customOptions_${currentDatabase}_${fieldType}`;
            const options = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const select = document.getElementById(selectId);
            
            if (select && options.length > 0) {
                options.forEach(value => {
                    // Check if option already exists
                    const exists = Array.from(select.options).some(opt => opt.value === value);
                    if (!exists) {
                        const option = document.createElement('option');
                        option.value = value;
                        option.textContent = value;
                        select.appendChild(option);
                    }
                });
            }
        }

        let editingRowId = null;

        // Edit Row - Open popup with pre-filled data
        function editRow(tableName, id) {
            const data = databases[currentDatabase][tableName];
            const row = data.find(r => r.id === id);
            
            if (!row) return;
            
            editingRowId = id;
            currentFormType = tableName;
            
            const modal = document.getElementById('addDataModal');
            const formFields = document.getElementById('formFields');
            const popupTitle = document.getElementById('popupTitle');
            
            // Special handling for Last In Out - only edit transactions
            if (tableName === 'lastInOut') {
                popupTitle.textContent = 'Edit Transactions - Last In Out';
                
                formFields.innerHTML = `
                    <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <h4 style="font-weight: 600; margin-bottom: 8px; color: #374151;">Read-Only Information</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; font-size: 14px;">
                            <div><strong>Bank:</strong> ${row.bankName}</div>
                            <div><strong>Holder:</strong> ${row.holderName}</div>
                            <div><strong>Account:</strong> ${row.accNumber}</div>
                            <div><strong>Last Balance:</strong> ${row.lastBalance}</div>
                            <div><strong>Issues:</strong> ${row.issues}</div>
                        </div>
                    </div>
                    
                    <h4 style="font-weight: 600; margin: 16px 0 12px; color: #1e40af;">Last In Transactions</h4>
                    
                    <div style="background: #eff6ff; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1e40af;">Last In (1)</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="text" name="lastIn1Date" class="form-input" value="${row.lastIn1Date || ''}">
                            </div>
                            <div>
                                <label class="form-label">Name</label>
                                <input type="text" name="lastIn1Name" class="form-input" value="${row.lastIn1Name || ''}">
                            </div>
                            <div>
                                <label class="form-label">Amount</label>
                                <input type="number" name="lastIn1Amount" class="form-input" step="0.01" value="${row.lastIn1Amount || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #eff6ff; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1e40af;">Last In (2)</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="text" name="lastIn2Date" class="form-input" value="${row.lastIn2Date || ''}">
                            </div>
                            <div>
                                <label class="form-label">Name</label>
                                <input type="text" name="lastIn2Name" class="form-input" value="${row.lastIn2Name || ''}">
                            </div>
                            <div>
                                <label class="form-label">Amount</label>
                                <input type="number" name="lastIn2Amount" class="form-input" step="0.01" value="${row.lastIn2Amount || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #eff6ff; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #1e40af;">Last In (3)</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="text" name="lastIn3Date" class="form-input" value="${row.lastIn3Date || ''}">
                            </div>
                            <div>
                                <label class="form-label">Name</label>
                                <input type="text" name="lastIn3Name" class="form-input" value="${row.lastIn3Name || ''}">
                            </div>
                            <div>
                                <label class="form-label">Amount</label>
                                <input type="number" name="lastIn3Amount" class="form-input" step="0.01" value="${row.lastIn3Amount || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <h4 style="font-weight: 600; margin: 16px 0 12px; color: #dc2626;">Last Out Transactions</h4>
                    
                    <div style="background: #fef2f2; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #dc2626;">Last Out (1)</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="text" name="lastOut1Date" class="form-input" value="${row.lastOut1Date || ''}">
                            </div>
                            <div>
                                <label class="form-label">Name</label>
                                <input type="text" name="lastOut1Name" class="form-input" value="${row.lastOut1Name || ''}">
                            </div>
                            <div>
                                <label class="form-label">Amount</label>
                                <input type="number" name="lastOut1Amount" class="form-input" step="0.01" value="${row.lastOut1Amount || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #fef2f2; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #dc2626;">Last Out (2)</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="text" name="lastOut2Date" class="form-input" value="${row.lastOut2Date || ''}">
                            </div>
                            <div>
                                <label class="form-label">Name</label>
                                <input type="text" name="lastOut2Name" class="form-input" value="${row.lastOut2Name || ''}">
                            </div>
                            <div>
                                <label class="form-label">Amount</label>
                                <input type="number" name="lastOut2Amount" class="form-input" step="0.01" value="${row.lastOut2Amount || ''}">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #fef2f2; padding: 12px; border-radius: 6px;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #dc2626;">Last Out (3)</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                            <div>
                                <label class="form-label">Date</label>
                                <input type="text" name="lastOut3Date" class="form-input" value="${row.lastOut3Date || ''}">
                            </div>
                            <div>
                                <label class="form-label">Name</label>
                                <input type="text" name="lastOut3Name" class="form-input" value="${row.lastOut3Name || ''}">
                            </div>
                            <div>
                                <label class="form-label">Amount</label>
                                <input type="number" name="lastOut3Amount" class="form-input" step="0.01" value="${row.lastOut3Amount || ''}">
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Regular edit for other tables
                const titles = {
                    stockEmail: 'Edit Stock Email',
                    accDetails: 'Edit Account Details',
                    accStatusCheck: 'Edit Account Status Check',
                    bankFollowUp: 'Edit Bank Issue',
                    operatorReport: 'Edit Operator Report'
                };
                popupTitle.textContent = titles[tableName];
                
                // Generate form fields
                formFields.innerHTML = getFormFields(tableName);
                
                // Pre-fill form with existing data
                setTimeout(() => {
                    const form = document.getElementById('addDataForm');
                    Object.keys(row).forEach(key => {
                        if (key !== 'id') {
                            const input = form.querySelector(`[name="${key}"]`);
                            if (input) {
                                input.value = row[key] || '';
                            }
                        }
                    });
                }, 100);
            }
            
            // Show modal
            modal.classList.add('active');
        }
        
        // Delete Row
        function deleteRow(tableName, id) {
            if (confirm('Are you sure you want to delete this row?')) {
                const data = databases[currentDatabase][tableName];
                const index = data.findIndex(row => row.id === id);
                if (index > -1) {
                    data.splice(index, 1);
                    saveToFirebase(currentDatabase, tableName, data);
                    
                    if (tableName === 'stockEmail') {
                        syncStockEmailAcrossDatabases(id, null, 'delete');
                    }
                    
                    renderTable(tableName);
                    if (tableName === 'operatorReport') {
                        renderHandlerSummary();
                    }
                    updateDashboard();
                    showSuccessNotification('Data deleted successfully!');
                }
            }
        }
        
        // Edit Stock Email Status (Wealth+ only) - Modal version
        let currentEditingStatusId = null;
        
        function editStockEmailStatus(id, email, currentStatus) {
            currentEditingStatusId = id;
            
            // Set email in modal
            document.getElementById('statusEditEmail').textContent = email;
            
            // Set current status in dropdown
            document.getElementById('statusEditSelect').value = currentStatus;
            
            // Show modal
            document.getElementById('statusEditModal').style.display = 'flex';
        }
        
        function closeStatusEditModal() {
            document.getElementById('statusEditModal').style.display = 'none';
            currentEditingStatusId = null;
        }
        
        function saveStatusEdit() {
            if (!currentEditingStatusId) return;
            
            const newStatus = document.getElementById('statusEditSelect').value;
            const data = databases[currentDatabase]['stockEmail'];
            const row = data.find(r => r.id === currentEditingStatusId);
            
            if (row) {
                row.status = newStatus;
                
                // Sync across databases
                syncStockEmailAcrossDatabases(currentEditingStatusId, row, 'update');
                
                renderTable('stockEmail');
                updateDashboard();
                showSuccessNotification('Status updated successfully!');
                
                closeStatusEditModal();
            }
        }
        
        // Filter Stock Email Table
        function filterStockEmailTable() {
            const assignFilter = document.getElementById('filterStockEmailAssign').value;
            const statusFilter = document.getElementById('filterStockEmailStatus').value;
            const rows = document.getElementById('tbodyStockEmail').getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const cells = row.getElementsByTagName('td');
                if (cells.length === 0) return;
                
                const assign = cells[5].textContent;
                const status = cells[6].textContent.trim();
                
                let showRow = true;
                
                if (assignFilter !== 'all' && assign !== assignFilter) {
                    showRow = false;
                }
                
                if (statusFilter !== 'all' && !status.includes(statusFilter)) {
                    showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }
        
        // Filter Acc Details Table
        function filterAccDetailsTable() {
            const bankFilter = document.getElementById('filterAccDetailsBank').value;
            const rows = document.getElementById('tbodyAccDetails').getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const cells = row.getElementsByTagName('td');
                if (cells.length === 0) return;
                
                const bankName = cells[0].textContent;
                
                if (bankFilter === 'all' || bankName === bankFilter) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Filter Acc Status Table
        function filterAccStatusTable() {
            const statusFilter = document.getElementById('filterAccStatusStatus').value;
            const rows = document.getElementById('tbodyAccStatusCheck').getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const cells = row.getElementsByTagName('td');
                if (cells.length === 0) return;
                
                const status = cells[7].textContent.trim();
                
                if (statusFilter === 'all' || status.includes(statusFilter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Filter Bank Issues Table
        function filterBankIssuesTable() {
            const bankFilter = document.getElementById('filterBankIssuesBank').value;
            const statusFilter = document.getElementById('filterBankIssuesStatus').value;
            const rows = document.getElementById('tbodyBankFollowUp').getElementsByTagName('tr');
            
            Array.from(rows).forEach(row => {
                const cells = row.getElementsByTagName('td');
                if (cells.length === 0) return;
                
                const bankName = cells[1].textContent;
                const status = cells[6].textContent.trim();
                
                let showRow = true;
                
                if (bankFilter !== 'all' && bankName !== bankFilter) {
                    showRow = false;
                }
                
                if (statusFilter !== 'all' && status !== statusFilter) {
                    showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        // Initialize month filters
        function initMonthFilters() {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
            
            const filters = ['filterBankActive', 'filterBankIssues', 'filterPaymentRent', 
                           'filterRecoverBalance', 'filterLostBalance'];
            
            filters.forEach(filterId => {
                const select = document.getElementById(filterId);
                months.forEach((month, index) => {
                    const option = document.createElement('option');
                    option.value = index + 1;
                    option.textContent = month;
                    select.appendChild(option);
                });
            });
        }

        // Login
        // Valid user accounts with their designated roles
        const validUsers = {
            'admin': { password: 'admin123', defaultRole: 'Others' },
            'bm_officer': { password: 'bm2025', defaultRole: 'BM Officer' },
            'pe_officer': { password: 'pe2025', defaultRole: 'PE Officer' },
            'wp_officer': { password: 'wp2025', defaultRole: 'Wealth+' }
        };
        
        let loggedInUser = null;
        
        // Initialize Firebase data loading
        loadFromFirebase();
        
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check if username exists and password matches
            if (validUsers[username] && validUsers[username].password === password) {
                loggedInUser = username;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('databaseSelectionPage').classList.remove('hidden');
                updateDatabaseCounts();
                initMonthFilters();
            } else {
                const errorMsg = document.getElementById('errorMessage');
                errorMsg.textContent = 'Invalid username or password!';
                errorMsg.classList.remove('hidden');
            }
        });

        // Export to CV (PDF)
        function exportToCV() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Get current database info
            const dbName = currentDatabase || 'SGD';
            const roleName = currentRole || 'User';
            
            // Title
            doc.setFontSize(20);
            doc.setFont(undefined, 'bold');
            doc.text('Bank Management Dashboard', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Database: ${dbName} - Role: ${roleName}`, 105, 30, { align: 'center' });
            doc.text(`Generated: ${new Date().toLocaleString()}`, 105, 38, { align: 'center' });
            
            let yPos = 50;
            
            // Export All Data from current database
            const tables = ['stockEmail', 'accDetails', 'accStatusCheck', 'bankFollowUp', 'lastInOut'];
            const tableNames = {
                stockEmail: 'Stock Email',
                accDetails: 'Account Details',
                accStatusCheck: 'Account Status Check',
                bankFollowUp: 'Bank Issues',
                lastInOut: 'Last In Out'
            };
            
            tables.forEach((tableName) => {
                const data = databases[currentDatabase][tableName];
                
                if (data && data.length > 0) {
                    // Add new page if needed
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    // Section title
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text(`${tableNames[tableName]} (${data.length} records)`, 20, yPos);
                    yPos += 10;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    
                    // Summary info only
                    data.slice(0, 5).forEach((row, index) => {
                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        if (tableName === 'accDetails') {
                            doc.text(`${index + 1}. ${row.bankName} - ${row.holderName} - ${row.accNumber}`, 25, yPos);
                        } else if (tableName === 'stockEmail') {
                            doc.text(`${index + 1}. ${row.email} - ${row.assign} - ${row.status}`, 25, yPos);
                        } else if (tableName === 'bankFollowUp') {
                            doc.text(`${index + 1}. ${row.bankName} - ${row.accNumber} - ${row.status}`, 25, yPos);
                        }
                        
                        yPos += 6;
                    });
                    
                    if (data.length > 5) {
                        doc.setFont(undefined, 'italic');
                        doc.text(`... and ${data.length - 5} more records`, 25, yPos);
                        doc.setFont(undefined, 'normal');
                        yPos += 6;
                    }
                    
                    yPos += 8;
                }
            });
            
            // Save PDF
            doc.save(`Bank-CV-${dbName}-${new Date().toISOString().slice(0,10)}.pdf`);
            
            showSuccessNotification('CV exported to PDF successfully!');
        }

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('logoutBtnRole').addEventListener('click', logout);
        document.getElementById('logoutBtn2').addEventListener('click', logout);

        function logout() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('databaseSelectionPage').classList.add('hidden');
            document.getElementById('roleSelectionPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            currentDatabase = null;
            currentRole = null;
            loggedInUser = null;
        }

        // Update Database Counts
        function updateDatabaseCounts() {
            document.getElementById('sgdCount').textContent = databases.SGD.accDetails.length;
            document.getElementById('myrCount').textContent = databases.MYR.accDetails.length;
            document.getElementById('khrCount').textContent = databases.KHR.accDetails.length;
        }

        // Select Database
        function selectDatabase(db) {
            currentDatabase = db;
            document.getElementById('databaseSelectionPage').classList.add('hidden');
            
            // Check if user has a default role (auto-login)
            if (loggedInUser && validUsers[loggedInUser].defaultRole !== 'Others') {
                // Auto-select role for specific users (skip role selection page)
                const autoRole = validUsers[loggedInUser].defaultRole;
                selectRole(autoRole);
            } else {
                // Show role selection page for admin/Others
                document.getElementById('roleSelectionPage').classList.remove('hidden');
                
                const dbNames = {
                    SGD: 'SGD Database - Singapore Dollar',
                    MYR: 'MYR Database - Malaysian Ringgit',
                    KHR: 'KHR Database - Cambodian Riel'
                };
                document.getElementById('selectedDatabaseText').textContent = dbNames[db];
            }
        }

        // Select Role
        let pendingRole = null;
        
        function selectRole(role) {
            // Security PIN required for BM Officer and Others
            if (role === 'BM Officer' || role === 'Others') {
                pendingRole = role;
                showPinModal(role);
                return;
            }
            
            // Direct access for PE Officer and Wealth+
            proceedToRole(role);
        }
        
        function showPinModal(role) {
            document.getElementById('pinRoleName').textContent = role;
            document.getElementById('pinInput').value = '';
            document.getElementById('pinMessage').style.display = 'none';
            document.getElementById('pinModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('pinInput').focus();
            }, 100);
            
            // Allow Enter key to verify
            document.getElementById('pinInput').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    verifyPin();
                }
            };
        }
        
        function verifyPin() {
            const pin = document.getElementById('pinInput').value;
            const messageEl = document.getElementById('pinMessage');
            
            if (pin === '252025') {
                // Success message
                messageEl.innerHTML = '<i class="fas fa-check-circle" style="margin-right: 8px;"></i>Login Successful!';
                messageEl.style.display = 'block';
                messageEl.style.background = '#d1fae5';
                messageEl.style.color = '#065f46';
                messageEl.style.border = '2px solid #10b981';
                
                setTimeout(() => {
                    document.getElementById('pinModal').style.display = 'none';
                    proceedToRole(pendingRole);
                }, 1000);
            } else {
                // Error message
                messageEl.innerHTML = '<i class="fas fa-times-circle" style="margin-right: 8px;"></i>Wrong PIN! Access Denied';
                messageEl.style.display = 'block';
                messageEl.style.background = '#fee2e2';
                messageEl.style.color = '#991b1b';
                messageEl.style.border = '2px solid #ef4444';
                
                // Shake animation
                const modal = document.querySelector('#pinModal > div');
                modal.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    modal.style.animation = '';
                }, 500);
                
                // Clear input
                document.getElementById('pinInput').value = '';
                document.getElementById('pinInput').focus();
            }
        }
        
        function cancelPinVerification() {
            document.getElementById('pinModal').style.display = 'none';
            pendingRole = null;
        }
        
        function hideAccDetailsSensitiveColumns(hide) {
            const table = document.getElementById('tableAccDetails');
            if (!table) return;
            
            // Column indices to hide: Bank PW/PIN (10), Email (11), Pass Email (12), Actions (15)
            const columnsToHide = [10, 11, 12, 15];
            
            // Hide/show header columns
            const headers = table.querySelectorAll('thead th');
            columnsToHide.forEach(index => {
                if (headers[index]) {
                    headers[index].style.display = hide ? 'none' : '';
                }
            });
            
            // Hide/show body columns
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                columnsToHide.forEach(index => {
                    if (cells[index]) {
                        cells[index].style.display = hide ? 'none' : '';
                    }
                });
            });
        }
        
        function proceedToRole(role) {
            currentRole = role;
            document.getElementById('roleSelectionPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            const messages = {
                SGD: 'Welcome to Singapore Bank Database',
                MYR: 'Welcome to Malaysia Bank Database',
                KHR: 'Welcome to Khmer Bank Database'
            };
            
            document.getElementById('welcomeMessage').textContent = messages[currentDatabase];
            document.getElementById('databaseRoleTitle').textContent = `${currentDatabase} Database - ${currentRole}`;
            
            // Control tab visibility based on role
            if (role === 'PE Officer') {
                // PE Officer: Only show Acc Details and Bank Issues
                document.getElementById('tabStockEmail').style.display = 'none';
                document.getElementById('tabAccDetails').style.display = 'inline-flex';
                document.getElementById('tabAccStatusCheck').style.display = 'none';
                document.getElementById('tabBankFollowUp').style.display = 'inline-flex';
                document.getElementById('tabLastInOut').style.display = 'none';
                document.getElementById('tabOperatorReport').style.display = 'none';
                document.getElementById('tabTemplate').style.display = 'none';
                
                // Hide Add Data button for Acc Details only
                document.getElementById('btnAddAccDetails').style.display = 'none';
                
                // Show Add Data button for Bank Issues (PE Officer can add Bank Issues)
                document.getElementById('btnAddBankIssues').style.display = 'inline-block';
                
                // Add PE Officer mode class to hide sensitive columns via CSS
                document.getElementById('dashboardPage').classList.add('pe-officer-mode');
                
                // Hide Export CV button (PE Officer cannot export)
                document.getElementById('exportCVBtn').style.display = 'none';
                
                // Switch to Acc Details as default tab for PE Officer
                switchTab('accDetails');
            } else if (role === 'Wealth+') {
                // Wealth+: Only show Stock Email, Acc Details, Bank Issues, and Template
                document.getElementById('tabStockEmail').style.display = 'inline-flex';
                document.getElementById('tabAccDetails').style.display = 'inline-flex';
                document.getElementById('tabAccStatusCheck').style.display = 'none';
                document.getElementById('tabBankFollowUp').style.display = 'inline-flex';
                document.getElementById('tabLastInOut').style.display = 'none';
                document.getElementById('tabOperatorReport').style.display = 'none';
                document.getElementById('tabTemplate').style.display = 'inline-flex';
                
                // Hide Add Data buttons for Stock Email, Acc Details, and Bank Issues
                document.getElementById('btnAddStockEmail').style.display = 'none';
                document.getElementById('btnAddAccDetails').style.display = 'none';
                document.getElementById('btnAddBankIssues').style.display = 'none';
                
                // Add Wealth+ mode class to hide sensitive columns via CSS
                document.getElementById('dashboardPage').classList.add('wealth-mode');
                
                // Hide Export CV button (Wealth+ cannot export)
                document.getElementById('exportCVBtn').style.display = 'none';
                
                // Switch to Stock Email as default tab for Wealth+
                switchTab('stockEmail');
            } else {
                // All other roles: Show all tabs
                document.getElementById('tabStockEmail').style.display = 'inline-flex';
                document.getElementById('tabAccDetails').style.display = 'inline-flex';
                document.getElementById('tabAccStatusCheck').style.display = 'inline-flex';
                document.getElementById('tabBankFollowUp').style.display = 'inline-flex';
                document.getElementById('tabLastInOut').style.display = 'inline-flex';
                document.getElementById('tabOperatorReport').style.display = 'inline-flex';
                document.getElementById('tabTemplate').style.display = 'inline-flex';
                
                // Show Add Data buttons
                document.getElementById('btnAddStockEmail').style.display = 'inline-block';
                document.getElementById('btnAddAccDetails').style.display = 'inline-block';
                document.getElementById('btnAddBankIssues').style.display = 'inline-block';
                
                // Remove both PE Officer and Wealth+ mode classes to show all columns
                document.getElementById('dashboardPage').classList.remove('pe-officer-mode');
                document.getElementById('dashboardPage').classList.remove('wealth-mode');
                
                // Show Export CV button (BM Officer and Others can export)
                document.getElementById('exportCVBtn').style.display = 'inline-block';
                
                // Switch to Stock Email as default tab for other roles
                switchTab('stockEmail');
            }
            
            // Populate bank filters based on current database
            populateBankFilters();
            
            // Reset all filters
            resetAllFilters();
            
            updateDashboard();
            renderAllTables();
        }
        
        // Update Dashboard
        function updateDashboard() {
            const data = databases[currentDatabase];
            
            const totalBankActive = data.accDetails.filter(acc => acc.status === 'Active').length;
            document.getElementById('totalBankActive').textContent = totalBankActive;
            
            const totalBankIssues = data.bankFollowUp.length;
            document.getElementById('totalBankIssues').textContent = totalBankIssues;
            
            const totalPaymentRent = data.accStatusCheck.reduce((sum, item) => {
                return sum + (parseFloat(item.paymentRent) || 0);
            }, 0);
            document.getElementById('totalPaymentRent').textContent = '$' + totalPaymentRent.toFixed(2);
            
            const totalRecoverBalance = data.bankFollowUp.reduce((sum, item) => {
                return sum + (parseFloat(item.totalRecoverBalance) || 0);
            }, 0);
            document.getElementById('totalRecoverBalance').textContent = '$' + totalRecoverBalance.toFixed(2);
            
            const totalLostBalance = data.bankFollowUp.reduce((sum, item) => {
                return sum + (parseFloat(item.totalLostBalance) || 0);
            }, 0);
            document.getElementById('totalLostBalance').textContent = '$' + totalLostBalance.toFixed(2);
        }
        
        // Render All Tables
        function renderAllTables() {
            const tables = ['stockEmail', 'accDetails', 'accStatusCheck', 'bankFollowUp', 'lastInOut', 'operatorReport'];
            tables.forEach(tableName => {
                const tbody = document.getElementById('tbody' + tableName.charAt(0).toUpperCase() + tableName.slice(1));
                if (tbody) {
                    tbody.innerHTML = '';
                    const data = databases[currentDatabase][tableName];
                    data.forEach(row => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = getRowHTML(tableName, row);
                        tbody.appendChild(tr);
                    });
                }
            });
        }
        
        // Get Row HTML with COLORS for Acc Status Check
        function getRowHTML(tableName, row) {
            if (tableName === 'accStatusCheck') {
                let statusColor = '';
                let statusIcon = '';
                if (row.status === 'Balance cleared' || row.status === 'Balance refunded') {
                    statusColor = '#9333ea';
                    statusIcon = 'ðŸŸ£';
                } else if (row.status === 'Balance In Progress') {
                    statusColor = '#f59e0b';
                    statusIcon = 'ðŸŸ¡';
                } else if (row.status === 'Bank Owner Used') {
                    statusColor = '#ef4444';
                    statusIcon = 'ðŸ”´';
                }
                
                return `
                    <td>${row.holderName}</td>
                    <td>${row.group}</td>
                    <td>${row.paymentRent}</td>
                    <td>${row.agent}</td>
                    <td>${row.totalReceive}</td>
                    <td>${row.balance}</td>
                    <td>${row.lost}</td>
                    <td><span style="font-weight: 600; color: ${statusColor};">${statusIcon} ${row.status}</span></td>
                    <td>${row.remark}</td>
                    <td>${row.month}</td>
                    <td style="white-space: nowrap;">
                        <button class="text-blue-600 hover:text-blue-900" onclick="editRow('accStatusCheck', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-danger" onclick="deleteRow('accStatusCheck', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
            }
            // Return empty for other tables for now - file asli Anda belum ada ini
            return '';
        }
        
        // Render Table
        function renderTable(tableName) {
            const tbody = document.getElementById('tbody' + tableName.charAt(0).toUpperCase() + tableName.slice(1));
            if (!tbody) return;
            
            const data = databases[currentDatabase][tableName];
            tbody.innerHTML = '';
            
            data.forEach((row) => {
                const tr = document.createElement('tr');
                tr.innerHTML = getRowHTML(tableName, row);
                tbody.appendChild(tr);
            });
        }
        
        // Get Row HTML
        function getRowHTML(tableName, row) {
            switch(tableName) {
                case 'stockEmail':
                    const statusBadge = row.status === 'Used' ? 'ðŸŸ¢' : row.status === 'New' ? 'ðŸ”µ' : 'ðŸ”´';
                    return `
                        <td>${row.date}</td>
                        <td>${row.email}</td>
                        <td class="stock-email-col-password">${row.password}</td>
                        <td>${row.numberPhone}</td>
                        <td class="stock-email-col-device">${row.device}</td>
                        <td>${row.assign}</td>
                        <td style="position: relative;">
                            <span style="font-weight: 600;">${statusBadge} ${row.status}</span>
                            <button class="stock-email-status-edit" onclick="editStockEmailStatus(${row.id}, '${row.email}', '${row.status}')" style="display: none; position: absolute; right: 8px; top: 50%; transform: translateY(-50%); padding: 6px 10px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 6px; cursor: pointer; color: #3b82f6; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='#eff6ff'">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                        <td class="stock-email-col-actions" style="white-space: nowrap;">
                            <button class="text-blue-600 hover:text-blue-900" onclick="editRow('stockEmail', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteRow('stockEmail', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                
                case 'accDetails':
                    let statusColor = '';
                    let statusIcon = '';
                    if (row.status === 'Active') { statusColor = '#10b981'; statusIcon = 'ðŸŸ¢'; }
                    else if (row.status === 'Suspend') { statusColor = '#ef4444'; statusIcon = 'ðŸ”´'; }
                    else if (row.status === 'On Hold' || row.status === 'Cooling period') { statusColor = '#f59e0b'; statusIcon = 'ðŸŸ¡'; }
                    else { statusColor = '#1f2937'; statusIcon = 'âš«'; }
                    
                    return `
                        <td>${row.bankName}</td>
                        <td>${row.holderName}</td>
                        <td>${row.accNumber}</td>
                        <td>${row.source || '-'}</td>
                        <td>${row.device}</td>
                        <td>${row.assign || '-'}</td>
                        <td><span style="color: ${statusColor}; font-weight: 600;">${statusIcon} ${row.status}</span></td>
                        <td>${row.remark || '-'}</td>
                        <td>${row.startDate}</td>
                        <td>${row.endDate || '-'}</td>
                        <td>${row.username}</td>
                        <td class="acc-details-col-bankpw">${row.bankPW}</td>
                        <td class="acc-details-col-email">${row.email}</td>
                        <td class="acc-details-col-passemail">${row.passEmail}</td>
                        <td>${row.vpn}</td>
                        <td>${row.agentName}</td>
                        <td class="acc-details-col-actions" style="white-space: nowrap;">
                            <button class="text-blue-600 hover:text-blue-900" onclick="editRow('accDetails', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteRow('accDetails', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                
                case 'accStatusCheck':
                    let accStatusColor = '';
                    let accStatusIcon = '';
                    if (row.status === 'Balance cleared' || row.status === 'Balance refunded') {
                        accStatusColor = '#9333ea';
                        accStatusIcon = 'ðŸŸ£';
                    } else if (row.status === 'Balance In Progress') {
                        accStatusColor = '#f59e0b';
                        accStatusIcon = 'ðŸŸ¡';
                    } else if (row.status === 'Bank Owner Used') {
                        accStatusColor = '#ef4444';
                        accStatusIcon = 'ðŸ”´';
                    }
                    
                    return `
                        <td>${row.holderName}</td>
                        <td>${row.group}</td>
                        <td>${row.paymentRent}</td>
                        <td>${row.agent}</td>
                        <td>${row.totalReceive}</td>
                        <td>${row.balance}</td>
                        <td>${row.lost}</td>
                        <td><span style="font-weight: 600; color: ${accStatusColor};">${accStatusIcon} ${row.status}</span></td>
                        <td>${row.remark}</td>
                        <td>${row.month}</td>
                        <td style="white-space: nowrap;">
                            <button class="text-blue-600 hover:text-blue-900" onclick="editRow('accStatusCheck', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteRow('accStatusCheck', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                
                case 'bankFollowUp':
                    // Status colors and icons for Bank Issues
                    let bankIssueStatusColor = '';
                    let bankIssueStatusIcon = '';
                    if (row.status === 'Pending' || row.status === 'In Progress') {
                        bankIssueStatusColor = '#f59e0b'; // Yellow/Orange for Pending & In Progress
                        bankIssueStatusIcon = 'ðŸŸ¡';
                    } else if (row.status === 'Success' || row.status === 'Resolved') {
                        bankIssueStatusColor = '#10b981'; // Green for Success & Resolved
                        bankIssueStatusIcon = 'ðŸŸ¢';
                    } else if (row.status === 'Failed') {
                        bankIssueStatusColor = '#ef4444'; // Red for Failed
                        bankIssueStatusIcon = 'ðŸ”´';
                    } else if (row.status === 'Closed') {
                        bankIssueStatusColor = '#1f2937'; // Black for Closed
                        bankIssueStatusIcon = 'âš«';
                    }
                    
                    return `
                        <td>${row.dateIssues}</td>
                        <td>${row.bankName}</td>
                        <td>${row.holderName}</td>
                        <td>${row.accNumber}</td>
                        <td>${row.device}</td>
                        <td>${row.issuesDesc}</td>
                        <td><span style="font-weight: 600; color: ${bankIssueStatusColor};">${bankIssueStatusIcon} ${row.status}</span></td>
                        <td>${row.handler}</td>
                        <td>${row.totalLostBalance}</td>
                        <td>${row.totalRecoverBalance}</td>
                        <td>${row.remark}</td>
                        <td class="bank-issues-col-actions" style="white-space: nowrap;">
                            <button class="text-blue-600 hover:text-blue-900" onclick="editRow('bankFollowUp', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteRow('bankFollowUp', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                
                case 'lastInOut':
                    return `
                        <td>${row.dateIssues}</td>
                        <td>${row.bankName}</td>
                        <td>${row.holderName}</td>
                        <td>${row.accNumber}</td>
                        <td>${row.lastBalance}</td>
                        <td style="max-width: 200px; white-space: normal; word-wrap: break-word;">${row.issues || '-'}</td>
                        <td style="border-left: 3px solid #059669;">${row.lastIn1Date || '-'}</td>
                        <td>${row.lastIn1Name || '-'}</td>
                        <td style="border-right: 3px solid #059669;">${row.lastIn1Amount || '-'}</td>
                        <td style="border-left: 3px solid #059669;">${row.lastIn2Date || '-'}</td>
                        <td>${row.lastIn2Name || '-'}</td>
                        <td style="border-right: 3px solid #059669;">${row.lastIn2Amount || '-'}</td>
                        <td style="border-left: 3px solid #059669;">${row.lastIn3Date || '-'}</td>
                        <td>${row.lastIn3Name || '-'}</td>
                        <td style="border-right: 3px solid #059669;">${row.lastIn3Amount || '-'}</td>
                        <td style="border-left: 3px solid #dc2626;">${row.lastOut1Date || '-'}</td>
                        <td>${row.lastOut1Name || '-'}</td>
                        <td style="border-right: 3px solid #dc2626;">${row.lastOut1Amount || '-'}</td>
                        <td style="border-left: 3px solid #dc2626;">${row.lastOut2Date || '-'}</td>
                        <td>${row.lastOut2Name || '-'}</td>
                        <td style="border-right: 3px solid #dc2626;">${row.lastOut2Amount || '-'}</td>
                        <td style="border-left: 3px solid #dc2626;">${row.lastOut3Date || '-'}</td>
                        <td>${row.lastOut3Name || '-'}</td>
                        <td style="border-right: 3px solid #dc2626;">${row.lastOut3Amount || '-'}</td>
                        <td style="white-space: nowrap;">
                            <button class="text-blue-600 hover:text-blue-900" onclick="editRow('lastInOut', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteRow('lastInOut', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                
                case 'operatorReport':
                    return `
                        <td>${row.dateTime}</td>
                        <td>${row.bankName}</td>
                        <td>${row.holderName}</td>
                        <td>${row.accNumber}</td>
                        <td>${row.device}</td>
                        <td>${row.handler}</td>
                        <td>${row.transferOutBalance}</td>
                        <td>${row.attachment}</td>
                        <td style="white-space: nowrap;">
                            <button class="text-blue-600 hover:text-blue-900" onclick="editRow('operatorReport', ${row.id})" style="padding: 4px 8px; margin: 2px; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 4px;">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="deleteRow('operatorReport', ${row.id})" style="padding: 4px 8px; margin: 2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                
                default:
                    return '';
            }
        }
        
        // Render Handler Summary with Month Filter
        function renderHandlerSummary() {
            const filterMonth = document.getElementById('handlerMonthFilter').value;
            const operatorData = databases[currentDatabase]['operatorReport'];
            
            const handlerData = {};
            
            operatorData.forEach(row => {
                if (!row.handler) return;
                
                const rowDate = new Date(row.dateTime);
                const rowMonth = rowDate.toLocaleString('default', { month: 'long', year: 'numeric' });
                
                if (filterMonth !== 'all' && rowMonth !== filterMonth) return;
                
                const key = `${row.handler}-${rowMonth}`;
                
                if (!handlerData[key]) {
                    handlerData[key] = {
                        handler: row.handler,
                        month: rowMonth,
                        total: 0
                    };
                }
                
                handlerData[key].total += parseFloat(row.transferOutBalance) || 0;
            });
            
            const tbody = document.getElementById('tbodyHandlerSummary');
            tbody.innerHTML = '';
            
            Object.values(handlerData).forEach(data => {
                const tr = document.createElement('tr');
                const onePercent = data.total * 0.01;
                const twoPercent = data.total * 0.02;
                const threePercent = data.total * 0.03;
                
                tr.innerHTML = `
                    <td style="font-weight: 600;">${data.handler}</td>
                    <td style="text-align: right; font-weight: 600;">${data.total.toFixed(2)}</td>
                    <td style="text-align: right; color: #10b981; font-weight: 600;">${onePercent.toFixed(2)}</td>
                    <td style="text-align: right; color: #10b981; font-weight: 600;">${twoPercent.toFixed(2)}</td>
                    <td style="text-align: right; color: #10b981; font-weight: 600;">${threePercent.toFixed(2)}</td>
                    <td style="text-align: center;">${data.month}</td>
                `;
                tbody.appendChild(tr);
            });
            
            // Populate month filter options
            const months = new Set();
            operatorData.forEach(row => {
                const date = new Date(row.dateTime);
                const monthYear = date.toLocaleString('default', { month: 'long', year: 'numeric' });
                months.add(monthYear);
            });
            
            const filter = document.getElementById('handlerMonthFilter');
            const currentOptions = Array.from(filter.options).map(o => o.value);
            
            months.forEach(month => {
                if (!currentOptions.includes(month)) {
                    const option = document.createElement('option');
                    option.value = month;
                    option.textContent = month;
                    filter.appendChild(option);
                }
            });
        }
        
        // Template Search Functions
        function searchAccountTemplate(event) {
            if (event && event.key !== 'Enter') {
                return;
            }
            
            const accountNumber = document.getElementById('templateAccountSearch').value.trim();
            const messageEl = document.getElementById('templateSearchMessage');
            
            if (accountNumber === '') {
                messageEl.innerHTML = '<i class="fas fa-info-circle"></i> Please enter an account number';
                messageEl.style.display = 'block';
                messageEl.style.color = '#f59e0b';
                messageEl.style.fontWeight = '600';
                messageEl.style.padding = '12px 16px';
                messageEl.style.background = '#fef3c7';
                messageEl.style.borderRadius = '6px';
                messageEl.style.border = '1px solid #f59e0b';
                return;
            }
            
            const account = databases[currentDatabase]['lastInOut'].find(
                acc => acc.accNumber === accountNumber
            );
            
            if (account) {
                displayTemplateAccount(account);
            } else {
                showTemplateNoResults();
                messageEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> No account found';
                messageEl.style.display = 'block';
                messageEl.style.color = '#ef4444';
                messageEl.style.fontWeight = '600';
                messageEl.style.padding = '12px 16px';
                messageEl.style.background = '#fee2e2';
                messageEl.style.borderRadius = '6px';
                messageEl.style.border = '1px solid #ef4444';
            }
        }
        
        function displayTemplateAccount(account) {
            const messageEl = document.getElementById('templateSearchMessage');
            messageEl.innerHTML = '<i class="fas fa-check-circle"></i> Data Found';
            messageEl.style.display = 'block';
            messageEl.style.color = '#10b981';
            messageEl.style.fontWeight = '600';
            messageEl.style.padding = '12px 16px';
            messageEl.style.background = '#d1fae5';
            messageEl.style.borderRadius = '6px';
            messageEl.style.border = '1px solid #10b981';
            
            document.getElementById('templateNoResults').style.display = 'none';
            document.getElementById('templateResults').style.display = 'block';
            
            const balance = parseFloat(account.lastBalance) || 0;
            const accountInfoHtml = `
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 16px; font-weight: 600; background: #f9fafb; width: 200px;">Account Number</td>
                    <td style="padding: 16px; font-size: 18px; font-weight: 600;">${account.accNumber}</td>
                </tr>
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 16px; font-weight: 600; background: #f9fafb;">Bank Name</td>
                    <td style="padding: 16px;">${account.bankName}</td>
                </tr>
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 16px; font-weight: 600; background: #f9fafb;">Account Holder Name</td>
                    <td style="padding: 16px;">${account.holderName}</td>
                </tr>
                <tr style="border-bottom: 1px solid #e5e7eb;">
                    <td style="padding: 16px; font-weight: 600; background: #f9fafb;">Bank Balance</td>
                    <td style="padding: 16px; font-weight: 600; color: ${balance > 0 ? '#10b981' : '#6b7280'};">$${balance.toFixed(2)}</td>
                </tr>
                <tr>
                    <td style="padding: 16px; font-weight: 600; background: #f9fafb;">Issues</td>
                    <td style="padding: 16px;">${account.issues || 'No issues'}</td>
                </tr>
            `;
            document.getElementById('templateAccountInfo').innerHTML = accountInfoHtml;
            
            const lastInHtml = `
                <tr style="background: #d1fae5; border-bottom: 1px solid #a7f3d0;">
                    <td style="padding: 12px 16px; font-weight: 600;">Date</td>
                    <td style="padding: 12px 16px;">${account.lastIn1Date || '-'}</td>
                </tr>
                <tr style="background: #d1fae5; border-bottom: 1px solid #a7f3d0;">
                    <td style="padding: 12px 16px; font-weight: 600;">Name</td>
                    <td style="padding: 12px 16px;">${account.lastIn1Name || '-'}</td>
                </tr>
                <tr style="background: #d1fae5; border-bottom: 2px solid #10b981;">
                    <td style="padding: 12px 16px; font-weight: 600;">Amount</td>
                    <td style="padding: 12px 16px; font-weight: 600;">$${account.lastIn1Amount || '0'}</td>
                </tr>
                <tr style="background: #f0fdf4; border-bottom: 1px solid #bbf7d0;">
                    <td style="padding: 12px 16px; font-weight: 600;">Date</td>
                    <td style="padding: 12px 16px;">${account.lastIn2Date || '-'}</td>
                </tr>
                <tr style="background: #f0fdf4; border-bottom: 1px solid #bbf7d0;">
                    <td style="padding: 12px 16px; font-weight: 600;">Name</td>
                    <td style="padding: 12px 16px;">${account.lastIn2Name || '-'}</td>
                </tr>
                <tr style="background: #f0fdf4; border-bottom: 2px solid #10b981;">
                    <td style="padding: 12px 16px; font-weight: 600;">Amount</td>
                    <td style="padding: 12px 16px; font-weight: 600;">$${account.lastIn2Amount || '0'}</td>
                </tr>
                <tr style="background: #d1fae5; border-bottom: 1px solid #a7f3d0;">
                    <td style="padding: 12px 16px; font-weight: 600;">Date</td>
                    <td style="padding: 12px 16px;">${account.lastIn3Date || '-'}</td>
                </tr>
                <tr style="background: #d1fae5; border-bottom: 1px solid #a7f3d0;">
                    <td style="padding: 12px 16px; font-weight: 600;">Name</td>
                    <td style="padding: 12px 16px;">${account.lastIn3Name || '-'}</td>
                </tr>
                <tr style="background: #d1fae5;">
                    <td style="padding: 12px 16px; font-weight: 600;">Amount</td>
                    <td style="padding: 12px 16px; font-weight: 600;">$${account.lastIn3Amount || '0'}</td>
                </tr>
            `;
            document.getElementById('templateLastIn').innerHTML = lastInHtml;
            
            const lastOutHtml = `
                <tr style="background: #fecaca; border-bottom: 1px solid #fca5a5;">
                    <td style="padding: 12px 16px; font-weight: 600;">Date</td>
                    <td style="padding: 12px 16px;">${account.lastOut1Date || '-'}</td>
                </tr>
                <tr style="background: #fecaca; border-bottom: 1px solid #fca5a5;">
                    <td style="padding: 12px 16px; font-weight: 600;">Name</td>
                    <td style="padding: 12px 16px;">${account.lastOut1Name || '-'}</td>
                </tr>
                <tr style="background: #fecaca; border-bottom: 2px solid #ef4444;">
                    <td style="padding: 12px 16px; font-weight: 600;">Amount</td>
                    <td style="padding: 12px 16px; font-weight: 600;">$${account.lastOut1Amount || '0'}</td>
                </tr>
                <tr style="background: #fef2f2; border-bottom: 1px solid #fecaca;">
                    <td style="padding: 12px 16px; font-weight: 600;">Date</td>
                    <td style="padding: 12px 16px;">${account.lastOut2Date || '-'}</td>
                </tr>
                <tr style="background: #fef2f2; border-bottom: 1px solid #fecaca;">
                    <td style="padding: 12px 16px; font-weight: 600;">Name</td>
                    <td style="padding: 12px 16px;">${account.lastOut2Name || '-'}</td>
                </tr>
                <tr style="background: #fef2f2; border-bottom: 2px solid #ef4444;">
                    <td style="padding: 12px 16px; font-weight: 600;">Amount</td>
                    <td style="padding: 12px 16px; font-weight: 600;">$${account.lastOut2Amount || '0'}</td>
                </tr>
                <tr style="background: #fecaca; border-bottom: 1px solid #fca5a5;">
                    <td style="padding: 12px 16px; font-weight: 600;">Date</td>
                    <td style="padding: 12px 16px;">${account.lastOut3Date || '-'}</td>
                </tr>
                <tr style="background: #fecaca; border-bottom: 1px solid #fca5a5;">
                    <td style="padding: 12px 16px; font-weight: 600;">Name</td>
                    <td style="padding: 12px 16px;">${account.lastOut3Name || '-'}</td>
                </tr>
                <tr style="background: #fecaca;">
                    <td style="padding: 12px 16px; font-weight: 600;">Amount</td>
                    <td style="padding: 12px 16px; font-weight: 600;">$${account.lastOut3Amount || '0'}</td>
                </tr>
            `;
            document.getElementById('templateLastOut').innerHTML = lastOutHtml;
        }
        
        function showTemplateNoResults() {
            document.getElementById('templateResults').style.display = 'none';
            document.getElementById('templateNoResults').style.display = 'block';
        }
        
        function clearTemplateSearch() {
            document.getElementById('templateAccountSearch').value = '';
            const messageEl = document.getElementById('templateSearchMessage');
            messageEl.innerHTML = '';
            messageEl.style.display = 'none';
            document.getElementById('templateResults').style.display = 'none';
            document.getElementById('templateNoResults').style.display = 'none';
        }
        
        // Reset All Filters
        function resetAllFilters() {
            // Reset Stock Email filters
            const filterStockAssign = document.getElementById('filterStockEmailAssign');
            const filterStockStatus = document.getElementById('filterStockEmailStatus');
            if (filterStockAssign) filterStockAssign.value = 'all';
            if (filterStockStatus) filterStockStatus.value = 'all';
            
            // Reset Acc Details filter
            const filterAccBank = document.getElementById('filterAccDetailsBank');
            if (filterAccBank) filterAccBank.value = 'all';
            
            // Reset Acc Status filter
            const filterAccStatus = document.getElementById('filterAccStatusStatus');
            if (filterAccStatus) filterAccStatus.value = 'all';
            
            // Reset Bank Issues filter
            const filterBankIssues = document.getElementById('filterBankIssuesBank');
            if (filterBankIssues) filterBankIssues.value = 'all';
            
            const filterBankIssuesStatus = document.getElementById('filterBankIssuesStatus');
            if (filterBankIssuesStatus) filterBankIssuesStatus.value = 'all';
            
            // Reset Handler Summary filter
            const filterHandlerMonth = document.getElementById('handlerMonthFilter');
            if (filterHandlerMonth) filterHandlerMonth.value = 'all';
            
            // Reset Template search
            const templateSearch = document.getElementById('templateAccountSearch');
            if (templateSearch) {
                templateSearch.value = '';
                document.getElementById('templateSearchMessage').innerHTML = '';
                document.getElementById('templateResults').style.display = 'none';
                document.getElementById('templateNoResults').style.display = 'none';
            }
        }

        // Back to Database Selection
        function backToDatabaseSelection() {
            document.getElementById('roleSelectionPage').classList.add('hidden');
            document.getElementById('databaseSelectionPage').classList.remove('hidden');
            currentDatabase = null;
        }

        // Back to Role Selection
        function backToSelection() {
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('roleSelectionPage').classList.remove('hidden');
            currentRole = null;
        }

        // Switch Tab
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = ['stockEmail', 'accDetails', 'accStatusCheck', 'bankFollowUp', 'lastInOut', 'operatorReport', 'template'];
            tabs.forEach(tab => {
                document.getElementById('content' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('hidden');
                document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById('content' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.remove('hidden');
            document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
            
            // Render Handler Summary when switching to Operator Report tab
            if (tabName === 'operatorReport') {
                renderHandlerSummary();
            }
        }

        // Add Data Functions
        function addRow(tableName) {
            const data = databases[currentDatabase][tableName];
            const newRow = createEmptyRow(tableName);
            data.push(newRow);
            renderTable(tableName);
            updateDashboard();
        }

        function createEmptyRow(tableName) {
            const today = new Date().toISOString().split('T')[0];
            const thisMonth = new Date().toLocaleString('default', { month: 'long' });
            
            switch(tableName) {
                case 'stockEmail':
                    return { id: Date.now(), date: today, email: '', password: '', numberPhone: '', device: '', assign: '', status: 'New' };
                case 'accDetails':
                    return { id: Date.now(), bankName: '', holderName: '', accNumber: '', source: '', device: '', assign: '', status: 'Active', startDate: today, endDate: '', username: '', bankPW: '', email: '', passEmail: '', vpn: '', agentName: '' };
                case 'accStatusCheck':
                    return { id: Date.now(), holderName: '', group: '', paymentRent: '', agent: '', totalReceive: '', balance: '', lost: '', status: 'Balance cleared', remark: '', month: thisMonth };
                case 'bankFollowUp':
                    return { id: Date.now(), dateIssues: today, bankName: '', holderName: '', accNumber: '', device: '', issuesDesc: '', status: 'Pending', handler: '', totalLostBalance: '0', totalRecoverBalance: '0', remark: '' };
                case 'operatorReport':
                    return { id: Date.now(), dateTime: '', bankName: '', holderName: '', accNumber: '', device: '', handler: '', transferOutBalance: '', attachment: '' };
                default:
                    return {};
            }
        }
        
        // Initialize on page load
        window.onload = function() {
            console.log('Bank Dashboard Loaded');
        };
    </script>

    <!-- Add Option Modal (Professional) -->
    <div id="addOptionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 16px; padding: 32px; width: 90%; max-width: 420px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease-out;">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-plus" style="font-size: 32px; color: white;"></i>
                </div>
                <h2 style="font-size: 22px; font-weight: 700; color: #1f2937; margin: 0 0 6px 0;">Add New Option</h2>
                <p style="color: #6b7280; font-size: 14px; margin: 0;" id="addOptionFieldLabel"></p>
            </div>
            
            <div style="margin-bottom: 24px;">
                <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Enter New Value</label>
                <input type="text" id="addOptionInput" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; transition: all 0.3s;" onfocus="this.style.borderColor='#10b981'" onblur="this.style.borderColor='#e5e7eb'">
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button onclick="closeAddOptionModal()" style="flex: 1; padding: 12px; background: #f3f4f6; color: #6b7280; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                    Cancel
                </button>
                <button onclick="saveNewOption()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(16, 185, 129, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.4)'">
                    <i class="fas fa-check" style="margin-right: 6px;"></i>Add Option
                </button>
            </div>
        </div>
    </div>

    <!-- Status Edit Modal (Wealth+) -->
    <div id="statusEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 16px; padding: 32px; width: 90%; max-width: 420px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease-out;">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-edit" style="font-size: 32px; color: white;"></i>
                </div>
                <h2 style="font-size: 22px; font-weight: 700; color: #1f2937; margin: 0 0 6px 0;">Edit Status</h2>
                <p style="color: #6b7280; font-size: 14px; margin: 0;" id="statusEditEmail"></p>
            </div>
            
            <div style="margin-bottom: 24px;">
                <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Select Status</label>
                <select id="statusEditSelect" style="width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; font-weight: 600; transition: all 0.3s;" onfocus="this.style.borderColor='#3b82f6'" onblur="this.style.borderColor='#e5e7eb'">
                    <option value="New" style="color: #3b82f6; font-weight: 600;">ðŸ”µ New</option>
                    <option value="Used" style="color: #10b981; font-weight: 600;">ðŸŸ¢ Used</option>
                    <option value="Suspend" style="color: #ef4444; font-weight: 600;">ðŸ”´ Suspend</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button onclick="closeStatusEditModal()" style="flex: 1; padding: 12px; background: #f3f4f6; color: #6b7280; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                    Cancel
                </button>
                <button onclick="saveStatusEdit()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)'">
                    <i class="fas fa-save" style="margin-right: 6px;"></i>Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- PIN Verification Modal -->
    <div id="pinModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 10000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 16px; padding: 40px; width: 90%; max-width: 450px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease-out;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-lock" style="font-size: 36px; color: white;"></i>
                </div>
                <h2 style="font-size: 24px; font-weight: 700; color: #1f2937; margin: 0 0 8px 0;">Security Verification</h2>
                <p style="color: #6b7280; font-size: 14px; margin: 0;">Enter your PIN to access <span id="pinRoleName" style="font-weight: 600; color: #667eea;"></span></p>
            </div>
            
            <div style="margin-bottom: 24px;">
                <label style="display: block; font-weight: 600; color: #374151; margin-bottom: 8px; font-size: 14px;">Security PIN</label>
                <input type="password" id="pinInput" maxlength="6" style="width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 16px; text-align: center; letter-spacing: 4px; font-weight: 600; transition: all 0.3s;" onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
            </div>
            
            <div id="pinMessage" style="display: none; padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 600; font-size: 14px;">
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button onclick="cancelPinVerification()" style="flex: 1; padding: 14px; background: #f3f4f6; color: #6b7280; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                    Cancel
                </button>
                <button onclick="verifyPin()" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)'">
                    <i class="fas fa-check-circle" style="margin-right: 6px;"></i>Verify
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }
        
        #pinInput::-webkit-outer-spin-button,
        #pinInput::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>

        <!-- Firebase Data Initialization Button (One-time use) -->
        <div id="firebaseInitBtn" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: none;">
            <button onclick="initializeFirebaseData(); this.parentElement.style.display='none'; showSuccessNotification('Data uploaded to Firebase!');" 
                    style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 12px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);">
                <i class="fas fa-cloud-upload-alt" style="margin-right: 8px;"></i>
                Upload Initial Data to Firebase
            </button>
            <p style="font-size: 11px; color: #6b7280; margin-top: 4px; text-align: center;">Click once only</p>
        </div>

</body>
</html>
